<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MDT | Ù†Ø¸Ø§Ù… ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@100;400;700;900&display=swap');
        
        :root { --primary: #0f172a; --secondary: #1e293b; --accent: #3b82f6; --danger: #ef4444; }
        body { font-family: 'Noto Kufi Arabic', sans-serif; background-color: #020617; color: #e2e8f0; margin: 0; }
        
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }

        .tactical-panel { background: var(--secondary); border: 1px solid rgba(59, 130, 246, 0.1); border-right: 4px solid var(--accent); border-radius: 12px; }
        .nav-active { background: var(--accent) !important; color: white !important; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3); }

        /* ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ø¬ÙˆØ§Ù„ */
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .main-content { margin-right: 0; padding-bottom: 100px; padding-top: 20px; }
            .mobile-nav { display: flex; position: fixed; bottom: 0; width: 100%; background: var(--primary); border-top: 1px solid rgba(255,255,255,0.05); z-index: 999; padding-bottom: 15px; }
            .card-grid { grid-template-columns: 1fr; }
        }

        /* ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± */
        @media (min-width: 769px) {
            .mobile-nav { display: none; }
            .sidebar { width: 280px; position: fixed; right: 0; top: 0; height: 100vh; background: var(--primary); z-index: 1000; border-left: 1px solid rgba(255,255,255,0.05); }
            .main-content { margin-right: 280px; padding: 40px; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, setDoc, doc, deleteDoc, query, orderBy, addDoc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCYgffN2dA7IILMbI2i_1YfERkKWIrpHyA",
            authDomain: "ek-police.firebaseapp.com",
            projectId: "ek-police",
            storageBucket: "ek-police.firebasestorage.app",
            messagingSenderId: "300605258409",
            appId: "1:300605258409:web:f265025ffa5592f651c7b8"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.fb = { db, collection, onSnapshot, setDoc, doc, deleteDoc, query, orderBy, addDoc, updateDoc, serverTimestamp };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const RANKS = ['General', 'Colonel', 'Major', 'Captain', 'Lieutenant', 'Sergeant', 'Officer', 'Cadet'];

        const App = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [currentUser, setCurrentUser] = useState(null);
            const [currentPage, setCurrentPage] = useState('dashboard');
            
            // Data States
            const [users, setUsers] = useState([]);
            const [criminals, setCriminals] = useState([]);
            const [reports, setReports] = useState([]);
            
            // Forms
            const [loginForm, setLoginForm] = useState({ id: '', password: '' });
            const [reportForm, setReportForm] = useState({ content: '', time: '', isEditing: false, docId: '' });
            const [userForm, setUserForm] = useState({ id: '', name: '', rank: 'Cadet', role: 'Ø±ØªØ¨Ø© ÙØ±Ø¯', password: '', department: '' });
            const [crimForm, setCrimForm] = useState({ name: '', crime: '' });
            const [searchTerm, setSearchTerm] = useState('');

            useEffect(() => {
                if (!window.fb) return;
                window.fb.onSnapshot(window.fb.collection(window.fb.db, "users"), s => setUsers(s.docs.map(d=>d.data())));
                window.fb.onSnapshot(window.fb.collection(window.fb.db, "criminals"), s => setCriminals(s.docs.map(d=>({...d.data(), fbId: d.id}))));
                const q = window.fb.query(window.fb.collection(window.fb.db, "field_reports"), window.fb.orderBy("createdAt", "desc"));
                window.fb.onSnapshot(q, s => setReports(s.docs.map(d=>({...d.data(), fbId: d.id}))));
            }, []);

            const isCommand = (u) => u?.id === '1001' || u?.role === 'Ø±ØªØ¨Ø© Ù‚ÙŠØ§Ø¯ÙŠØ©';

            const handleLogin = () => {
                const u = users.find(x => x.id === loginForm.id && x.password === loginForm.password);
                if (u) { setCurrentUser(u); setIsLoggedIn(true); } else alert('Ø®Ø·Ø£ ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„');
            };

            const saveReport = async () => {
                if(!reportForm.content) return;
                const data = { 
                    content: reportForm.content, incidentTime: reportForm.time, 
                    authorName: currentUser.name, authorId: currentUser.id, 
                    createdAt: window.fb.serverTimestamp() 
                };
                if(reportForm.isEditing) await window.fb.updateDoc(window.fb.doc(window.fb.db, "field_reports", reportForm.docId), data);
                else await window.fb.addDoc(window.fb.collection(window.fb.db, "field_reports"), data);
                setReportForm({ content: '', time: '', isEditing: false, docId: '' });
            };

            const NavItem = ({id, icon, label}) => (
                <button onClick={()=>setCurrentPage(id)} className={`flex flex-col md:flex-row items-center gap-3 p-3 md:px-6 md:py-4 w-full transition-all ${currentPage===id?'nav-active':'text-slate-400'}`}>
                    <span className="text-xl">{icon}</span>
                    <span className="text-[10px] md:text-sm font-bold">{label}</span>
                </button>
            );

            if (!isLoggedIn) return (
                <div className="min-h-screen flex items-center justify-center p-6 bg-[#020617]">
                    <div className="w-full max-w-sm text-center">
                        <img src="https://cdn.discordapp.com/attachments/1453507995781693634/1464367144228622516/185-1855065_los-santos-police-department-president-of-the-united-states-removebg-preview.png?ex=697535ad&is=6973e42d&hm=36374c04aa1f881264eab683cba0d57d347dd41b654467b3c21cf8181f977e3e&" className="w-32 h-32 mx-auto mb-6 object-contain" />
                        <h1 className="text-2xl font-black mb-8 tracking-tighter text-white">Ù†Ø¸Ø§Ù… Ø§Ù„Ù€ MDT Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ</h1>
                        <div className="space-y-3">
                            <input type="text" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ" className="w-full p-4 rounded-xl bg-slate-900 border border-slate-700 text-center focus:border-blue-500 outline-none" onChange={e=>setLoginForm({...loginForm, id: e.target.value})} />
                            <input type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" className="w-full p-4 rounded-xl bg-slate-900 border border-slate-700 text-center focus:border-blue-500 outline-none" onChange={e=>setLoginForm({...loginForm, password: e.target.value})} />
                            <button onClick={handleLogin} className="w-full bg-blue-600 p-4 rounded-xl font-bold shadow-lg active:scale-95 transition-all">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen">
                    {/* Sidebar Desktop */}
                    <aside className="sidebar flex flex-col">
                        <div className="p-8 text-center border-b border-white/5">
                            <img src="https://cdn.discordapp.com/attachments/1453507995781693634/1464367144228622516/185-1855065_los-santos-police-department-president-of-the-united-states-removebg-preview.png?ex=697535ad&is=6973e42d&hm=36374c04aa1f881264eab683cba0d57d347dd41b654467b3c21cf8181f977e3e&" className="w-20 h-20 mx-auto mb-4" />
                            <h2 className="font-black text-blue-500 uppercase text-xs tracking-widest">Ministry of Interior</h2>
                        </div>
                        <nav className="flex-grow pt-4">
                            <NavItem id="dashboard" icon="ğŸ“Š" label="Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…" />
                            <NavItem id="reports" icon="ğŸ“„" label="Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ©" />
                            <NavItem id="schedule" icon="ğŸ“‹" label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚ÙˆØ©" />
                            <NavItem id="criminals" icon="âš–ï¸" label="Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†" />
                            {isCommand(currentUser) && <NavItem id="admin" icon="ğŸ› ï¸" label="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…" />}
                        </nav>
                        <div className="p-4 border-t border-white/5">
                            <div className="flex items-center gap-3 p-3 bg-white/5 rounded-xl mb-4 text-xs font-bold">
                                <div className="w-8 h-8 rounded bg-blue-600 flex items-center justify-center">â­</div>
                                <div><p>{currentUser.name}</p><p className="text-blue-500">{currentUser.id}</p></div>
                            </div>
                            <button onClick={()=>setIsLoggedIn(false)} className="w-full p-3 bg-red-600/10 text-red-500 rounded-xl text-xs font-bold">Ø®Ø±ÙˆØ¬</button>
                        </div>
                    </aside>

                    {/* Bottom Nav Mobile */}
                    <nav className="mobile-nav">
                        <NavItem id="dashboard" icon="ğŸ“Š" label="Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" />
                        <NavItem id="reports" icon="ğŸ“„" label="Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±" />
                        <NavItem id="schedule" icon="ğŸ“‹" label="Ø§Ù„Ù‚ÙˆØ©" />
                        <NavItem id="criminals" icon="âš–ï¸" label="Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†" />
                        {isCommand(currentUser) && <NavItem id="admin" icon="ğŸ› ï¸" label="Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©" />}
                    </nav>

                    {/* Main Content */}
                    <main className="main-content">
                        <header className="mb-8 p-4 md:p-0">
                            <h1 className="text-3xl font-black">
                                {currentPage==='dashboard' && 'Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©'}
                                {currentPage==='reports' && 'Ù…Ø±ÙƒØ² Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±'}
                                {currentPage==='schedule' && 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ÙØ±Ø§Ø¯'}
                                {currentPage==='criminals' && 'ØªØ¹Ù…ÙŠÙ…Ø§Øª Ø£Ù…Ù†ÙŠØ©'}
                                {currentPage==='admin' && 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†'}
                            </h1>
                        </header>

                        {/* DASHBOARD PAGE */}
                        {currentPage === 'dashboard' && (
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 p-4 md:p-0">
                                <div className="tactical-panel p-8">
                                    <p className="text-xs font-bold text-gray-500 mb-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙˆØ©</p>
                                    <h2 className="text-5xl font-black">{users.length}</h2>
                                </div>
                                <div className="tactical-panel p-8 border-r-red-600">
                                    <p className="text-xs font-bold text-gray-500 mb-2">Ù…Ø°ÙƒØ±Ø§Øª ØªØ¹Ù…ÙŠÙ…</p>
                                    <h2 className="text-5xl font-black text-red-500">{criminals.length}</h2>
                                </div>
                                <div className="tactical-panel p-8 border-r-amber-500">
                                    <p className="text-xs font-bold text-gray-500 mb-2">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</p>
                                    <h2 className="text-5xl font-black text-amber-500">{reports.length}</h2>
                                </div>
                            </div>
                        )}

                        {/* REPORTS PAGE */}
                        {currentPage === 'reports' && (
                            <div className="max-w-4xl mx-auto space-y-6 p-4 md:p-0">
                                <div className="tactical-panel p-6 border-r-blue-500">
                                    <h3 className="font-black mb-4">Ø¥Ø¶Ø§ÙØ© Ø¨Ù„Ø§Øº Ø¬Ø¯ÙŠØ¯</h3>
                                    <input type="text" placeholder="Ø§Ù„ÙˆÙ‚Øª (Ù…Ø«Ù„Ø§Ù‹ 10:00 Ù…Ø³Ø§Ø¡Ù‹)" className="w-full p-4 mb-3 rounded-xl bg-slate-900" value={reportForm.time} onChange={e=>setReportForm({...reportForm, time: e.target.value})} />
                                    <textarea placeholder="ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ©..." className="w-full p-4 h-32 rounded-xl bg-slate-900" value={reportForm.content} onChange={e=>setReportForm({...reportForm, content: e.target.value})}></textarea>
                                    <button onClick={saveReport} className="w-full bg-blue-600 p-4 rounded-xl font-bold mt-4 shadow-lg shadow-blue-900/20">Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                                </div>
                                <div className="space-y-4">
                                    {reports.map(r => (
                                        <div key={r.fbId} className="tactical-panel p-6 border-white/5">
                                            <div className="flex justify-between items-start mb-4">
                                                <div className="flex items-center gap-3 text-xs">
                                                    <div className="p-2 bg-blue-600 rounded font-bold">{r.authorId}</div>
                                                    <div><p className="font-black text-sm">{r.authorName}</p><p className="text-gray-500">{r.incidentTime}</p></div>
                                                </div>
                                            </div>
                                            <p className="text-sm text-gray-300 pr-4 border-r-2 border-blue-500/30">{r.content}</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* SCHEDULE PAGE */}
                        {currentPage === 'schedule' && (
                            <div className="tactical-panel overflow-hidden">
                                <table className="w-full text-right text-sm">
                                    <thead className="bg-slate-900 text-gray-400 text-[10px] uppercase">
                                        <tr><th className="p-5">Ø§Ù„Ø§Ø³Ù…</th><th className="p-5">Ø§Ù„Ø±ØªØ¨Ø©</th><th className="p-5">Ø§Ù„Ø±Ù‚Ù…</th></tr>
                                    </thead>
                                    <tbody className="divide-y divide-white/5">
                                        {users.map(u => (
                                            <tr key={u.id} className="hover:bg-white/5 transition-all">
                                                <td className="p-5 font-black">{u.name}</td>
                                                <td className="p-5 text-blue-400 font-mono text-xs">{u.rank}</td>
                                                <td className="p-5 font-mono text-gray-500">{u.id}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}

                        {/* ADMIN PAGE (FULL CONTROL) */}
                        {currentPage === 'admin' && isCommand(currentUser) && (
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 p-4 md:p-0">
                                <div className="tactical-panel p-6 border-r-amber-500">
                                    <h3 className="font-black mb-6">Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø³ÙƒØ±ÙŠ</h3>
                                    <div className="space-y-4 text-xs font-bold">
                                        <input type="text" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ" className="w-full p-4 rounded-xl bg-slate-900 border border-slate-800" value={userForm.id} onChange={e=>setUserForm({...userForm, id:e.target.value})} />
                                        <input type="text" placeholder="Ø§Ù„Ø§Ø³Ù…" className="w-full p-4 rounded-xl bg-slate-900 border border-slate-800" value={userForm.name} onChange={e=>setUserForm({...userForm, name:e.target.value})} />
                                        <input type="text" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" className="w-full p-4 rounded-xl bg-slate-900 border border-slate-800" value={userForm.password} onChange={e=>setUserForm({...userForm, password:e.target.value})} />
                                        <select className="w-full p-4 rounded-xl bg-slate-900 border border-slate-800" value={userForm.rank} onChange={e=>setUserForm({...userForm, rank:e.target.value})}>
                                            {RANKS.map(r => <option key={r} value={r}>{r}</option>)}
                                        </select>
                                        <select className="w-full p-4 rounded-xl bg-slate-900 border border-slate-800" value={userForm.role} onChange={e=>setUserForm({...userForm, role:e.target.value})}>
                                            <option>Ø±ØªØ¨Ø© ÙØ±Ø¯</option><option>Ø±ØªØ¨Ø© Ø¶Ø§Ø¨Ø·</option><option>Ø±ØªØ¨Ø© Ù‚ÙŠØ§Ø¯ÙŠØ©</option>
                                        </select>
                                        <button onClick={async()=>{await window.fb.setDoc(window.fb.doc(window.fb.db,"users",userForm.id),userForm); alert('ØªÙ… Ø§Ù„Ø­ÙØ¸'); setUserForm({id:'',name:'',rank:'Cadet',role:'Ø±ØªØ¨Ø© ÙØ±Ø¯',password:'',department:''})}} className="w-full bg-amber-600 p-4 rounded-xl font-black">ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚ÙˆØ©</button>
                                    </div>
                                </div>
                                <div className="space-y-3">
                                    {users.map(u => (
                                        <div key={u.id} className="tactical-panel p-4 flex justify-between items-center text-xs">
                                            <div><p className="font-black">{u.name}</p><p className="text-gray-500">{u.id} - {u.rank}</p></div>
                                            <div className="flex gap-2">
                                                <button onClick={()=>setUserForm(u)} className="p-2 text-blue-500">ØªØ¹Ø¯ÙŠÙ„</button>
                                                {u.id !== '1001' && <button onClick={async()=>confirm('Ø­Ø°ÙØŸ')&&await window.fb.deleteDoc(window.fb.doc(window.fb.db,"users",u.id))} className="p-2 text-red-500">Ø­Ø°Ù</button>}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* CRIMINALS PAGE */}
                        {currentPage === 'criminals' && (
                            <div className="max-w-2xl mx-auto space-y-4 p-4 md:p-0">
                                {isCommand(currentUser) && (
                                    <div className="tactical-panel p-6 border-r-red-600 mb-8">
                                        <h3 className="font-black mb-4">Ø¥ØµØ¯Ø§Ø± Ù…Ø°ÙƒØ±Ø© ØªØ¹Ù…ÙŠÙ…</h3>
                                        <div className="flex gap-2">
                                            <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨" className="flex-grow p-4 rounded-xl bg-slate-900" value={crimForm.name} onChange={e=>setCrimForm({...crimForm, name: e.target.value})} />
                                            <input type="text" placeholder="Ø§Ù„ØªÙ‡Ù…Ø©" className="flex-grow p-4 rounded-xl bg-slate-900" value={crimForm.crime} onChange={e=>setCrimForm({...crimForm, crime: e.target.value})} />
                                            <button onClick={async()=>{await window.fb.addDoc(window.fb.collection(window.fb.db,"criminals"),crimForm); setCrimForm({name:'',crime:''})}} className="bg-red-600 px-6 rounded-xl font-bold">Ù†Ø´Ø±</button>
                                        </div>
                                    </div>
                                )}
                                {criminals.map(c => (
                                    <div key={c.fbId} className="tactical-panel p-6 border-r-red-600 flex justify-between items-center">
                                        <div><h4 className="text-xl font-black text-red-600">{c.name}</h4><p className="text-xs font-bold text-gray-500">{c.crime}</p></div>
                                        {isCommand(currentUser) && <button onClick={async()=>await window.fb.deleteDoc(window.fb.doc(window.fb.db,"criminals",c.fbId))} className="text-red-500 text-xs font-bold">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ù„Ù</button>}
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
