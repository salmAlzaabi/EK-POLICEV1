<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MDT | CENTRAL COMMAND</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@300;500;700;900&display=swap');
        
        body { 
            font-family: 'Noto Kufi Arabic', sans-serif; 
            background: #020617; 
            color: #f8fafc; 
            overflow: hidden; 
            height: 100vh;
        }

        .glass-card {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        .nav-item {
            transition: 0.4s;
            border-right: 3px solid transparent;
        }

        .nav-active {
            background: linear-gradient(to left, rgba(59, 130, 246, 0.15), transparent);
            border-right: 3px solid #3b82f6;
            color: #3b82f6;
        }

        .tactical-input {
            background: rgba(0,0,0,0.3) !important;
            border: 1px solid rgba(255,255,255,0.1) !important;
            transition: 0.3s;
        }

        .tactical-input:focus {
            border-color: #3b82f6 !important;
            box-shadow: 0 0 15px rgba(59,130,246,0.2);
        }

        /* Mobile Bottom Nav */
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .mobile-bottom-nav { display: flex; position: fixed; bottom: 0; left: 0; right: 0; background: #0f172a; height: 70px; border-top: 1px solid rgba(255,255,255,0.05); z-index: 50; }
            .main-content { padding-bottom: 90px; }
        }

        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, setDoc, doc, deleteDoc, query, orderBy, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCYgffN2dA7IILMbI2i_1YfERkKWIrpHyA",
            authDomain: "ek-police.firebaseapp.com",
            projectId: "ek-police",
            storageBucket: "ek-police.firebasestorage.app",
            messagingSenderId: "300605258409",
            appId: "1:300605258409:web:f265025ffa5592f651c7b8"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.fb = { db, collection, onSnapshot, setDoc, doc, deleteDoc, query, orderBy, addDoc, serverTimestamp };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const App = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [user, setUser] = useState(null);
            const [page, setPage] = useState('dashboard');
            const [searchQuery, setSearchQuery] = useState('');
            const [data, setData] = useState({ users: [], reports: [], uniforms: [] });
            const [forms, setForms] = useState({ login: {id:'', pass:''}, report: '', uniform: {name:'', img:''} });

            useEffect(() => {
                if (!window.fb) return;
                window.fb.onSnapshot(window.fb.collection(window.fb.db, "users"), s => setData(p => ({...p, users: s.docs.map(d=>d.data())})));
                window.fb.onSnapshot(window.fb.collection(window.fb.db, "uniforms"), s => setData(p => ({...p, uniforms: s.docs.map(d=>({...d.data(), fid: d.id}))})));
                const q = window.fb.query(window.fb.collection(window.fb.db, "field_reports"), window.fb.orderBy("createdAt", "desc"));
                window.fb.onSnapshot(q, s => setData(p => ({...p, reports: s.docs.map(d=>({...d.data(), fid: d.id}))})));
            }, []);

            const formatID = (id) => id === '1001' ? 'A-1' : id;
            const isLeader = (u) => u?.id === '1001' || u?.role === 'ÿ±ÿ™ÿ®ÿ© ŸÇŸäÿßÿØŸäÿ©';

            const filteredReports = useMemo(() => {
                return data.reports.filter(r => 
                    r.content.toLowerCase().includes(searchQuery.toLowerCase()) || 
                    r.authorName.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    r.authorId.includes(searchQuery)
                );
            }, [searchQuery, data.reports]);

            const handleLogin = () => {
                const searchID = forms.login.id.trim().toUpperCase() === 'A-1' ? '1001' : forms.login.id;
                const found = data.users.find(u => u.id === searchID && u.password === forms.login.pass);
                if (found) { setUser(found); setIsLoggedIn(true); } else alert("‚ùå ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿØÿÆŸàŸÑ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©");
            };

            if (!isLoggedIn) return (
                <div className="h-screen flex items-center justify-center p-6 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]">
                    <div className="glass-card w-full max-w-md p-10 rounded-[2.5rem] text-center animate__animated animate__zoomIn">
                        <div className="w-24 h-24 bg-gradient-to-br from-blue-600 to-indigo-900 rounded-3xl mx-auto mb-6 flex items-center justify-center shadow-2xl">
                            <span className="text-5xl">üõ°Ô∏è</span>
                        </div>
                        <h2 className="text-3xl font-black mb-2 tracking-tighter uppercase">Justice MDT</h2>
                        <p className="text-slate-500 text-xs mb-8 font-bold italic">ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑŸÖÿ±ŸÉÿ≤Ÿäÿ©</p>
                        <div className="space-y-4">
                            <input className="tactical-input w-full p-4 rounded-2xl text-center font-bold" placeholder="ÿßŸÑÿ±ŸÇŸÖ ÿßŸÑÿπÿ≥ŸÉÿ±Ÿä (A-1)" onChange={e=>setForms({...forms, login:{...forms.login, id:e.target.value}})} />
                            <input type="password" className="tactical-input w-full p-4 rounded-2xl text-center font-bold" placeholder="ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±" onChange={e=>setForms({...forms, login:{...forms.login, pass:e.target.value}})} />
                            <button onClick={handleLogin} className="w-full bg-blue-600 hover:bg-blue-500 py-4 rounded-2xl font-black transition-all shadow-lg shadow-blue-500/20">ÿØÿÆŸàŸÑ ÿßŸÑŸÜÿ∏ÿßŸÖ</button>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="flex h-screen overflow-hidden">
                    {/* Sidebar Desktop */}
                    <aside className="sidebar w-80 glass-card m-4 rounded-[2rem] flex flex-col p-6">
                        <div className="mb-10 p-4">
                            <div className="flex items-center gap-3">
                                <div className="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-xl">ü¶Ö</div>
                                <h1 className="text-2xl font-black italic tracking-tighter">CENTRAL</h1>
                            </div>
                        </div>
                        <nav className="flex-grow space-y-2">
                            <NavItem active={page==='dashboard'} onClick={()=>setPage('dashboard')} icon="üìä" label="ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ" />
                            <NavItem active={page==='reports'} onClick={()=>setPage('reports')} icon="üìù" label="ÿ£ÿ±ÿ¥ŸäŸÅ ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±" />
                            <NavItem active={page==='uniforms'} onClick={()=>setPage('uniforms')} icon="üëï" label="ÿßŸÑŸÖÿ≥ÿ™ŸàÿØÿπ ÿßŸÑÿπÿ≥ŸÉÿ±Ÿä" />
                            <NavItem active={page==='force'} onClick={()=>setPage('force')} icon="üë•" label="ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÇŸàÿ©" />
                            {isLeader(user) && <NavItem active={page==='admin'} onClick={()=>setPage('admin')} icon="‚öôÔ∏è" label="ÿßŸÑÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿπŸÑŸäÿß" color="text-amber-500" />}
                        </nav>
                        <div className="mt-auto glass-card p-4 rounded-2xl flex items-center gap-4 border-none bg-white/5">
                            <div className="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center font-black">{formatID(user.id)}</div>
                            <div className="overflow-hidden">
                                <p className="text-sm font-black truncate">{user.name}</p>
                                <button onClick={()=>window.location.reload()} className="text-[10px] text-red-500 font-bold uppercase">Logout</button>
                            </div>
                        </div>
                    </aside>

                    {/* Mobile Bottom Nav */}
                    <div className="mobile-bottom-nav hidden">
                        <button onClick={()=>setPage('dashboard')} className={`flex-1 text-2xl ${page==='dashboard'?'text-blue-500':''}`}>üìä</button>
                        <button onClick={()=>setPage('reports')} className={`flex-1 text-2xl ${page==='reports'?'text-blue-500':''}`}>üìù</button>
                        <button onClick={()=>setPage('uniforms')} className={`flex-1 text-2xl ${page==='uniforms'?'text-blue-500':''}`}>üëï</button>
                        <button onClick={()=>setPage('force')} className={`flex-1 text-2xl ${page==='force'?'text-blue-500':''}`}>üë•</button>
                    </div>

                    {/* Main Content */}
                    <main className="main-content flex-grow overflow-y-auto p-4 md:p-10 relative">
                        <header className="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-4">
                            <div>
                                <h2 className="text-4xl font-black uppercase italic tracking-widest animate__animated animate__fadeInLeft">{page}</h2>
                                <div className="h-1.5 w-24 bg-blue-600 rounded-full mt-2"></div>
                            </div>
                            
                            {/* Search Bar - Global */}
                            <div className="w-full md:w-96 relative animate__animated animate__fadeInRight">
                                <span className="absolute left-4 top-1/2 -translate-y-1/2 opacity-40">üîç</span>
                                <input 
                                    className="tactical-input w-full p-4 pl-12 rounded-2xl text-sm" 
                                    placeholder="ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿ™ŸÇÿßÿ±Ÿäÿ±ÿå ÿ£ŸÅÿ±ÿßÿØÿå ÿ£Ÿà ÿ£ÿ±ŸÇÿßŸÖ ÿπÿ≥ŸÉÿ±Ÿäÿ©..." 
                                    value={searchQuery}
                                    onChange={e=>setSearchQuery(e.target.value)}
                                />
                            </div>
                        </header>

                        {/* Reports Section */}
                        {page === 'reports' && (
                            <div className="max-w-6xl mx-auto space-y-8 animate__animated animate__fadeIn">
                                <div className="glass-card p-8 rounded-[2.5rem] border-r-4 border-blue-600">
                                    <h3 className="text-xl font-black mb-4 flex items-center gap-2"><span>‚úçÔ∏è</span> ŸÉÿ™ÿßÿ®ÿ© ÿ®ŸÑÿßÿ∫ ŸÖŸäÿØÿßŸÜŸä</h3>
                                    <textarea className="tactical-input w-full h-32 p-4 rounded-2xl mb-4 text-sm" placeholder="ÿßŸÉÿ™ÿ® ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ±ÿ©..." onChange={e=>setForms({...forms, report:e.target.value})}></textarea>
                                    <button onClick={async()=>{
                                        if(!forms.report) return;
                                        await window.fb.addDoc(window.fb.collection(window.fb.db, "field_reports"), {
                                            content: forms.report, authorName: user.name, authorId: user.id, createdAt: window.fb.serverTimestamp()
                                        });
                                        setForms({...forms, report:''});
                                    }} className="bg-blue-600 hover:bg-blue-500 px-8 py-3 rounded-xl font-black transition-all">ÿ£ÿ±ÿ¥ŸÅÿ© ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±</button>
                                </div>

                                <div className="grid gap-6">
                                    {filteredReports.map(r => (
                                        <div key={r.fid} className="glass-card p-6 rounded-[2rem] border-r-2 border-blue-500/30 hover:bg-white/5 transition-all">
                                            <div className="flex justify-between items-center mb-4 border-b border-white/5 pb-3">
                                                <div className="flex items-center gap-3">
                                                    <span className="bg-blue-600 px-3 py-1 rounded-lg text-xs font-black">{formatID(r.authorId)}</span>
                                                    <span className="font-bold">{r.authorName}</span>
                                                </div>
                                                <span className="text-[10px] text-slate-500 font-mono italic uppercase">
                                                    {r.createdAt?.toDate().toLocaleString('ar-EG')}
                                                </span>
                                            </div>
                                            <p className="text-slate-300 leading-relaxed text-sm">{r.content}</p>
                                        </div>
                                    ))}
                                    {filteredReports.length === 0 && <p className="text-center text-slate-500 py-10 font-bold">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÜÿ™ÿßÿ¶ÿ¨ ŸÖÿ∑ÿßÿ®ŸÇÿ© ŸÑÿ®ÿ≠ÿ´ŸÉ</p>}
                                </div>
                            </div>
                        )}

                        {/* Dashboard Stats */}
                        {page === 'dashboard' && (
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-8 animate__animated animate__zoomIn">
                                <StatBox label="ÿßŸÑŸÇŸàÿ© ÿßŸÑÿπÿßŸÖŸÑÿ©" value={data.users.length} icon="üíÇ" color="blue" />
                                <StatBox label="ÿ™ŸÇÿßÿ±Ÿäÿ± ÿßŸÑÿ£ÿ±ÿ¥ŸäŸÅ" value={data.reports.length} icon="üìÇ" color="indigo" />
                                <StatBox label="ŸÇÿ∑ÿπ ÿßŸÑŸÖÿ≥ÿ™ŸàÿØÿπ" value={data.uniforms.length} icon="üì¶" color="amber" />
                                
                                <div className="md:col-span-2 glass-card p-8 rounded-[2.5rem]">
                                    <h3 className="text-xl font-black mb-6">ÿ¢ÿÆÿ± ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ± ÿßŸÑŸÖŸäÿØÿßŸÜŸäÿ©</h3>
                                    <div className="space-y-4">
                                        {data.reports.slice(0, 3).map(r => (
                                            <div key={r.fid} className="flex items-center gap-4 bg-white/5 p-4 rounded-2xl border-l-2 border-blue-500">
                                                <div className="text-xs font-black text-blue-500">{formatID(r.authorId)}</div>
                                                <div className="text-xs truncate text-slate-400">{r.content}</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Uniforms Grid */}
                        {page === 'uniforms' && (
                            <div className="space-y-10 animate__animated animate__fadeIn">
                                {isLeader(user) && (
                                    <div className="glass-card p-8 rounded-[2rem] max-w-xl">
                                        <h3 className="font-black mb-6 text-blue-500">ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ŸàÿØÿπ ÿßŸÑÿπÿ≥ŸÉÿ±Ÿä</h3>
                                        <div className="space-y-4">
                                            <input className="tactical-input w-full p-4 rounded-xl" placeholder="ÿßÿ≥ŸÖ ÿßŸÑÿ∑ŸÇŸÖ" onChange={e=>setForms({...forms, uniform:{...forms.uniform, name:e.target.value}})} />
                                            <input className="tactical-input w-full p-4 rounded-xl" placeholder="ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿµŸàÿ±ÿ©" onChange={e=>setForms({...forms, uniform:{...forms.uniform, img:e.target.value}})} />
                                            <button onClick={async()=>await window.fb.addDoc(window.fb.collection(window.fb.db, "uniforms"), forms.uniform)} className="w-full bg-blue-600 py-4 rounded-xl font-black">ÿ•ÿ∂ÿßŸÅÿ©</button>
                                        </div>
                                    </div>
                                )}
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                                    {data.uniforms.map(u => (
                                        <div key={u.fid} className="glass-card rounded-[2.5rem] overflow-hidden group">
                                            <div className="h-72 relative">
                                                <img src={u.img} className="w-full h-full object-cover group-hover:scale-110 transition-all" />
                                                <div className="absolute inset-0 bg-gradient-to-t from-black to-transparent opacity-80"></div>
                                                <div className="absolute bottom-6 right-6 text-right">
                                                    <p className="text-[10px] text-blue-400 font-black uppercase">Tactical Gear</p>
                                                    <h4 className="text-xl font-black">{u.name}</h4>
                                                </div>
                                                {isLeader(user) && <button onClick={async()=>await window.fb.deleteDoc(window.fb.doc(window.fb.db, "uniforms", u.fid))} className="absolute top-4 left-4 bg-red-600/20 text-red-500 p-2 rounded-lg text-xs font-black">ÿ≠ÿ∞ŸÅ</button>}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Force Roster */}
                        {page === 'force' && (
                            <div className="glass-card rounded-[2.5rem] overflow-hidden animate__animated animate__fadeIn">
                                <table className="w-full text-right border-collapse">
                                    <thead className="bg-white/5">
                                        <tr>
                                            <th className="p-6 text-xs font-black text-slate-500 uppercase">ÿßŸÑÿ±ŸÇŸÖ</th>
                                            <th className="p-6 text-xs font-black text-slate-500 uppercase">ÿßŸÑÿ±ÿ™ÿ®ÿ©</th>
                                            <th className="p-6 text-xs font-black text-slate-500 uppercase">ÿßŸÑÿßÿ≥ŸÖ</th>
                                            <th className="p-6 text-xs font-black text-slate-500 uppercase text-center">ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-white/5">
                                        {data.users.filter(u=>u.name.includes(searchQuery) || u.id.includes(searchQuery)).map(u => (
                                            <tr key={u.id} className="hover:bg-blue-600/5 transition-all group">
                                                <td className="p-6 font-mono font-black text-blue-500">{formatID(u.id)}</td>
                                                <td className="p-6 text-sm font-bold uppercase">{u.rank}</td>
                                                <td className="p-6 text-sm font-black">{u.name}</td>
                                                <td className="p-6 text-center">
                                                    <span className="bg-green-500/10 text-green-500 px-3 py-1 rounded-lg text-[10px] font-black uppercase">Active</span>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const NavItem = ({active, onClick, icon, label, color="text-slate-400"}) => (
            <div onClick={onClick} className={`nav-item p-4 cursor-pointer flex items-center gap-4 font-bold rounded-2xl ${active ? 'nav-active' : color + ' hover:bg-white/5'}`}>
                <span className="text-xl">{icon}</span>
                <span className="text-sm tracking-tighter uppercase">{label}</span>
            </div>
        );

        const StatBox = ({label, value, icon, color}) => (
            <div className={`glass-card p-8 rounded-[2.5rem] border-b-4 border-${color}-500 relative group overflow-hidden`}>
                <div className="flex justify-between items-start">
                    <div>
                        <p className="text-[10px] font-black text-slate-500 uppercase mb-1">{label}</p>
                        <h3 className="text-5xl font-black italic">{value}</h3>
                    </div>
                    <div className="text-4xl opacity-20 group-hover:scale-125 transition-all">{icon}</div>
                </div>
            </div>
        );

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
