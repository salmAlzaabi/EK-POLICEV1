<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <link rel="icon" type="image/png" href="https://cdn.discordapp.com/emojis/1394931233825361930.webp?size=160&animated=true">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MDT | POLICE SYSTEM</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@100;400;700;900&display=swap');
        
        body { 
            font-family: 'Noto Kufi Arabic', sans-serif; 
            background: #020617; color: #e2e8f0; margin: 0; overflow: hidden;
        }

        /* Tactical UI Glassmorphism */
        .glass-panel { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.05); }
        .sidebar { width: 280px; background: #0f172a; border-left: 1px solid rgba(255,255,255,0.05); }
        .nav-link { transition: 0.3s; border-radius: 12px; margin: 4px 15px; display: flex; align-items: center; gap: 12px; color: #94a3b8; }
        .nav-active { background: #3b82f6 !important; color: white !important; box-shadow: 0 0 20px rgba(59, 130, 246, 0.4); }
        
        .card-tactical { background: #1e293b; border-right: 4px solid #3b82f6; border-radius: 15px; transition: 0.3s; }
        .card-tactical:hover { transform: scale(1.02); background: #232f45; }

        input, select, textarea { background: #0f172a !important; border: 1px solid #334155 !important; color: white !important; outline: none; padding: 12px; border-radius: 10px; width: 100%; }
        
        /* Mobile Optimization */
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .main-view { padding-bottom: 100px !important; }
            .mobile-nav { display: flex !important; position: fixed; bottom: 0; width: 100%; height: 70px; background: #0f172a; z-index: 1000; border-top: 1px solid #334155; justify-content: space-around; align-items: center; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, setDoc, doc, deleteDoc, query, orderBy, addDoc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCYgffN2dA7IILMbI2i_1YfERkKWIrpHyA",
            authDomain: "ek-police.firebaseapp.com",
            projectId: "ek-police",
            storageBucket: "ek-police.firebasestorage.app",
            messagingSenderId: "300605258409",
            appId: "1:300605258409:web:f265025ffa5592f651c7b8"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.fb = { db, collection, onSnapshot, setDoc, doc, deleteDoc, query, orderBy, addDoc, updateDoc, serverTimestamp };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const RANK_LIST = [
            { id: 'General', weight: 19 }, { id: 'Colonel', weight: 15 }, { id: 'Major', weight: 14 },
            { id: 'Captain', weight: 13 }, { id: 'Lieutenant', weight: 11 }, { id: 'Sergeant', weight: 8 },
            { id: 'Officer', weight: 3 }, { id: 'Cadet', weight: 1 }
        ];

        const App = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [user, setUser] = useState(null);
            const [page, setPage] = useState('dashboard');
            
            const [data, setData] = useState({ users: [], reports: [], criminals: [], uniforms: [] });
            const [forms, setForms] = useState({ login: {}, uniform: {}, report: {}, admin: {rank: 'Cadet', role: 'ÿ±ÿ™ÿ®ÿ© ŸÅÿ±ÿØ'} });

            useEffect(() => {
                if (!window.fb) return;
                window.fb.onSnapshot(window.fb.collection(window.fb.db, "users"), s => setData(p => ({...p, users: s.docs.map(d=>d.data())})));
                window.fb.onSnapshot(window.fb.collection(window.fb.db, "criminals"), s => setData(p => ({...p, criminals: s.docs.map(d=>({...d.data(), fid: d.id}))})));
                window.fb.onSnapshot(window.fb.collection(window.fb.db, "uniforms"), s => setData(p => ({...p, uniforms: s.docs.map(d=>({...d.data(), fid: d.id}))})));
                const q = window.fb.query(window.fb.collection(window.fb.db, "field_reports"), window.fb.orderBy("createdAt", "desc"));
                window.fb.onSnapshot(q, s => setData(p => ({...p, reports: s.docs.map(d=>({...d.data(), fid: d.id}))})));
            }, []);

            // ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿ±ŸÇŸÖ ÿßŸÑÿπÿ≥ŸÉÿ±Ÿä ŸÑŸÑÿπÿ±ÿ∂
            const formatID = (id) => id === '1001' ? 'A-1' : id;
            const isLeader = (u) => u?.id === '1001' || u?.role === 'ÿ±ÿ™ÿ®ÿ© ŸÇŸäÿßÿØŸäÿ©';

            const handleLogin = () => {
                const found = data.users.find(u => u.id === forms.login.id && u.password === forms.login.pass);
                if (found) { setUser(found); setIsLoggedIn(true); } else alert("ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿØÿÆŸàŸÑ ÿÆÿßÿ∑ÿ¶ÿ©");
            };

            const NavBtn = ({p, icon, label}) => (
                <button onClick={()=>setPage(p)} className={`p-4 nav-link ${page===p ? 'nav-active' : ''}`}>
                    <span className="text-xl">{icon}</span>
                    <span className="font-bold text-sm">{label}</span>
                </button>
            );

            if (!isLoggedIn) return (
                <div className="h-screen flex items-center justify-center bg-[#020617] p-6">
                    <div className="glass-panel w-full max-w-md p-10 rounded-[40px] text-center border-blue-500/20 shadow-2xl">
                        <img src="https://cdn.discordapp.com/emojis/1394931233825361930.webp" className="w-24 h-24 mx-auto mb-6" />
                        <h2 className="text-2xl font-black mb-8">ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ∂ÿ®ÿ∑ ÿßŸÑÿπÿ≥ŸÉÿ±Ÿä</h2>
                        <div className="space-y-4">
                            <input type="text" placeholder="ÿßŸÑÿ±ŸÇŸÖ ÿßŸÑÿπÿ≥ŸÉÿ±Ÿä (1001)" onChange={e=>setForms({...forms, login:{...forms.login, id:e.target.value}})} />
                            <input type="password" placeholder="ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±" onChange={e=>setForms({...forms, login:{...forms.login, pass:e.target.value}})} />
                            <button onClick={handleLogin} className="w-full bg-blue-600 p-4 rounded-2xl font-black hover:bg-blue-500 transition-all">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</button>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="flex h-screen">
                    {/* Desktop Sidebar */}
                    <aside className="sidebar hidden md:flex flex-col py-8">
                        <div className="text-center mb-10">
                            <h1 className="text-xl font-black text-blue-500 tracking-tighter">POLICE MDT</h1>
                            <p className="text-[10px] text-slate-500 font-bold uppercase">Tactical Interface</p>
                        </div>
                        <nav className="flex-grow">
                            <NavBtn p="dashboard" icon="üìä" label="ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ" />
                            <NavBtn p="uniforms" icon="üëï" label="ŸÖŸÑÿßÿ®ÿ≥ ÿßŸÑÿπÿ≥ŸÉÿ±" />
                            <NavBtn p="reports" icon="üìù" label="ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±" />
                            <NavBtn p="force" icon="üë•" label="ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÇŸàÿ©" />
                            <NavBtn p="wanted" icon="‚ö†Ô∏è" label="ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ŸäŸÜ" />
                            {isLeader(user) && <NavBtn p="admin" icon="‚öôÔ∏è" label="ÿßŸÑÿ•ÿØÿßÿ±ÿ©" />}
                        </nav>
                        <div className="mt-auto px-6 border-t border-white/5 pt-6">
                            <div className="flex items-center gap-3 bg-white/5 p-3 rounded-2xl">
                                <div className="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center font-bold">{formatID(user.id)}</div>
                                <div className="text-xs font-bold truncate">
                                    <p>{user.name}</p>
                                    <button onClick={()=>setIsLoggedIn(false)} className="text-red-500">ÿÆÿ±Ÿàÿ¨</button>
                                </div>
                            </div>
                        </div>
                    </aside>

                    {/* Mobile Nav */}
                    <nav className="mobile-nav hidden">
                        <button onClick={()=>setPage('dashboard')} className={page==='dashboard'?'text-blue-500':''}>üìä</button>
                        <button onClick={()=>setPage('uniforms')} className={page==='uniforms'?'text-blue-500':''}>üëï</button>
                        <button onClick={()=>setPage('reports')} className={page==='reports'?'text-blue-500':''}>üìù</button>
                        <button onClick={()=>setPage('force')} className={page==='force'?'text-blue-500':''}>üë•</button>
                        {isLeader(user) && <button onClick={()=>setPage('admin')} className={page==='admin'?'text-blue-500':''}>‚öôÔ∏è</button>}
                    </nav>

                    {/* Main Content Area */}
                    <main className="main-view flex-grow overflow-y-auto p-6 md:p-12">
                        <header className="mb-10 flex justify-between items-end border-b border-white/5 pb-6">
                            <div>
                                <h2 className="text-3xl md:text-5xl font-black italic uppercase tracking-tighter">
                                    {page === 'dashboard' && 'Status'}
                                    {page === 'uniforms' && 'Uniforms'}
                                    {page === 'reports' && 'Field Ops'}
                                    {page === 'force' && 'Roster'}
                                    {page === 'wanted' && 'BOLO List'}
                                    {page === 'admin' && 'HQ Admin'}
                                </h2>
                            </div>
                            <div className="text-left">
                                <p className="text-[10px] font-bold text-slate-500 uppercase">Current User</p>
                                <p className="text-blue-500 font-black">{formatID(user.id)}</p>
                            </div>
                        </header>

                        {/* Page: Dashboard */}
                        {page === 'dashboard' && (
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div className="card-tactical p-8"><p className="text-xs text-slate-400 font-bold mb-2">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÇŸàÿ©</p><h3 className="text-5xl font-black">{data.users.length}</h3></div>
                                <div className="card-tactical p-8 border-r-red-600"><p className="text-xs text-slate-400 font-bold mb-2">ÿ™ÿπŸÖŸäŸÖÿßÿ™ ŸÜÿ¥ÿ∑ÿ©</p><h3 className="text-5xl font-black text-red-500">{data.criminals.length}</h3></div>
                                <div className="card-tactical p-8 border-r-amber-500"><p className="text-xs text-slate-400 font-bold mb-2">ŸÇÿ∑ÿπ ÿßŸÑŸÖŸÑÿßÿ®ÿ≥</p><h3 className="text-5xl font-black text-amber-500">{data.uniforms.length}</h3></div>
                            </div>
                        )}

                        {/* Page: Uniforms (New) */}
                        {page === 'uniforms' && (
                            <div className="space-y-8">
                                {isLeader(user) && (
                                    <div className="card-tactical p-6 max-w-2xl border-r-blue-500">
                                        <h3 className="font-bold mb-4">ÿ•ÿ∂ÿßŸÅÿ© ÿ∑ŸÇŸÖ ÿ¨ÿØŸäÿØ ŸÑŸÑŸÖÿ≥ÿ™ŸàÿØÿπ</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <input placeholder="ÿßÿ≥ŸÖ ÿßŸÑÿ∑ŸÇŸÖ" value={forms.uniform.name||''} onChange={e=>setForms({...forms, uniform:{...forms.uniform, name:e.target.value}})} />
                                            <input placeholder="ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿµŸàÿ±ÿ©" value={forms.uniform.img||''} onChange={e=>setForms({...forms, uniform:{...forms.uniform, img:e.target.value}})} />
                                        </div>
                                        <button onClick={async()=>{
                                            await window.fb.addDoc(window.fb.collection(window.fb.db, "uniforms"), forms.uniform);
                                            setForms({...forms, uniform: {}});
                                        }} className="mt-4 bg-blue-600 w-full p-3 rounded-lg font-bold">ÿ≠ŸÅÿ∏ ŸÅŸä ÿßŸÑÿ£ÿ±ÿ¥ŸäŸÅ</button>
                                    </div>
                                )}
                                <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
                                    {data.uniforms.map(u => (
                                        <div key={u.fid} className="glass-panel p-4 rounded-3xl group">
                                            <img src={u.img} className="w-full h-48 object-cover rounded-2xl mb-4" />
                                            <div className="flex justify-between items-center px-2">
                                                <span className="font-black text-sm uppercase">{u.name}</span>
                                                {isLeader(user) && <button onClick={async()=>await window.fb.deleteDoc(window.fb.doc(window.fb.db, "uniforms", u.fid))} className="text-red-500 text-xs font-bold">ÿ≠ÿ∞ŸÅ</button>}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Page: Force List */}
                        {page === 'force' && (
                            <div className="glass-panel rounded-3xl overflow-hidden">
                                <table className="w-full text-right">
                                    <thead className="bg-white/5 text-[10px] text-slate-400 uppercase">
                                        <tr><th className="p-6">ÿßŸÑÿ±ŸÇŸÖ</th><th className="p-6">ÿßŸÑÿ±ÿ™ÿ®ÿ©</th><th className="p-6">ÿßŸÑÿßÿ≥ŸÖ</th></tr>
                                    </thead>
                                    <tbody className="divide-y divide-white/5">
                                        {data.users.map(u => (
                                            <tr key={u.id} className="hover:bg-white/5 transition-all">
                                                <td className="p-6 font-mono text-blue-500 font-bold">{formatID(u.id)}</td>
                                                <td className="p-6 text-xs"><span className="bg-blue-500/10 px-3 py-1 rounded-full text-blue-400">{u.rank}</span></td>
                                                <td className="p-6 font-bold">{u.name}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}

                        {/* Page: Admin */}
                        {page === 'admin' && isLeader(user) && (
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-10">
                                <div className="card-tactical p-8 border-r-amber-500">
                                    <h3 className="text-xl font-black mb-6">ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸàÿ∏ŸÅŸäŸÜ</h3>
                                    <div className="space-y-4">
                                        <input placeholder="ÿßŸÑÿ±ŸÇŸÖ ÿßŸÑÿπÿ≥ŸÉÿ±Ÿä" onChange={e=>setForms({...forms, admin:{...forms.admin, id:e.target.value}})} />
                                        <input placeholder="ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ" onChange={e=>setForms({...forms, admin:{...forms.admin, name:e.target.value}})} />
                                        <input placeholder="ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±" onChange={e=>setForms({...forms, admin:{...forms.admin, pass:e.target.value}})} />
                                        <select onChange={e=>setForms({...forms, admin:{...forms.admin, rank:e.target.value}})}>
                                            {RANK_LIST.map(r => <option key={r.id} value={r.id}>{r.id}</option>)}
                                        </select>
                                        <button onClick={async()=>{
                                            await window.fb.setDoc(window.fb.doc(window.fb.db, "users", forms.admin.id), {
                                                id: forms.admin.id, name: forms.admin.name, password: forms.admin.pass, rank: forms.admin.rank, role: forms.admin.role
                                            });
                                            alert("ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™");
                                        }} className="w-full bg-amber-600 p-4 rounded-xl font-black">ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ≥ÿ¨ŸÑ</button>
                                    </div>
                                </div>
                                <div className="space-y-3">
                                    {data.users.map(u => (
                                        <div key={u.id} className="glass-panel p-4 rounded-2xl flex justify-between items-center">
                                            <span className="font-bold text-sm">{formatID(u.id)} - {u.name}</span>
                                            {u.id !== '1001' && <button onClick={async()=>await window.fb.deleteDoc(window.fb.doc(window.fb.db, "users", u.id))} className="text-red-500 font-bold text-xs">ÿ≠ÿ∞ŸÅ</button>}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Page: Reports */}
                        {page === 'reports' && (
                            <div className="max-w-4xl mx-auto space-y-6">
                                <div className="card-tactical p-6 border-r-blue-500">
                                    <textarea className="w-full h-32 mb-4" placeholder="ÿßŸÉÿ™ÿ® ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ±ÿ©..." onChange={e=>setForms({...forms, report:{...forms.report, content:e.target.value}})}></textarea>
                                    <button onClick={async()=>{
                                        await window.fb.addDoc(window.fb.collection(window.fb.db, "field_reports"), {
                                            content: forms.report.content, authorName: user.name, authorId: user.id, createdAt: window.fb.serverTimestamp()
                                        });
                                        alert("ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ±");
                                    }} className="w-full bg-blue-600 p-4 rounded-xl font-bold">ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ŸÑŸÑÿ£ÿ±ÿ¥ŸäŸÅ</button>
                                </div>
                                {data.reports.map(r => (
                                    <div key={r.fid} className="glass-panel p-6 rounded-3xl border-r-2 border-blue-500/20">
                                        <div className="flex justify-between mb-4 text-xs font-bold text-blue-400">
                                            <span>ÿ®Ÿàÿßÿ≥ÿ∑ÿ©: {formatID(r.authorId)} - {r.authorName}</span>
                                        </div>
                                        <p className="text-sm text-slate-300 leading-relaxed">{r.content}</p>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* Page: Wanted */}
                        {page === 'wanted' && (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {isLeader(user) && (
                                    <div className="card-tactical p-6 col-span-full border-r-red-600">
                                        <div className="flex gap-4">
                                            <input placeholder="ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®" onChange={e=>setForms({...forms, criminal:{...forms.criminal, name:e.target.value}})} />
                                            <input placeholder="ÿßŸÑÿ¨ÿ±ŸäŸÖÿ©" onChange={e=>setForms({...forms, criminal:{...forms.criminal, crime:e.target.value}})} />
                                            <button onClick={async()=>await window.fb.addDoc(window.fb.collection(window.fb.db, "criminals"), forms.criminal)} className="bg-red-600 px-8 rounded-lg font-bold">ÿ™ÿπŸÖŸäŸÖ</button>
                                        </div>
                                    </div>
                                )}
                                {data.criminals.map(c => (
                                    <div key={c.fid} className="glass-panel p-6 rounded-3xl border-r-4 border-red-600 flex justify-between items-center">
                                        <div><h4 className="text-xl font-black text-red-500 uppercase">{c.name}</h4><p className="text-xs text-slate-500 font-bold">{c.crime}</p></div>
                                        {isLeader(user) && <button onClick={async()=>await window.fb.deleteDoc(window.fb.doc(window.fb.db, "criminals", c.fid))} className="text-red-500 font-bold">ÿ•ÿ∫ŸÑÿßŸÇ</button>}
                                    </div>
                                ))}
                            </div>
                        )}

                    </main>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
