<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MDT | Tactical Elite</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@300;500;800&display=swap');
        
        body {
            font-family: 'Noto Kufi Arabic', sans-serif;
            background: #020617;
            background-image: 
                radial-gradient(at 0% 0%, rgba(30, 58, 138, 0.15) 0, transparent 50%), 
                radial-gradient(at 100% 100%, rgba(30, 58, 138, 0.1) 0, transparent 50%);
            color: #f1f5f9;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
        }

        /* Glassmorphism Classes */
        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .tactical-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.4), rgba(15, 23, 42, 0.4));
            border-right: 3px solid #3b82f6;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .tactical-card:hover {
            transform: translateY(-2px);
            border-right-width: 6px;
            background: rgba(30, 41, 59, 0.6);
        }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .page-entry { animation: fadeIn 0.4s ease-out forwards; }

        /* Mobile Optimization */
        @media (max-width: 768px) {
            .desktop-sidebar { display: none; }
            .content-area { margin-right: 0 !important; padding: 16px !important; padding-bottom: 100px !important; }
            .mobile-bottom-nav { 
                display: flex; position: fixed; bottom: 0; width: 100%; 
                background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(20px);
                border-top: 1px solid rgba(255,255,255,0.08); z-index: 1000;
                padding-bottom: env(safe-area-inset-bottom);
            }
            .stats-grid { grid-template-columns: 1fr 1fr; }
        }

        @media (min-width: 769px) {
            .mobile-bottom-nav { display: none; }
            .desktop-sidebar { width: 280px; position: fixed; right: 0; top: 0; height: 100vh; z-index: 1000; }
            .content-area { margin-right: 280px; padding: 40px; }
        }

        .nav-btn-active { color: #3b82f6 !important; background: rgba(59, 130, 246, 0.1); border-radius: 12px; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, setDoc, doc, deleteDoc, query, orderBy, addDoc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyCYgffN2dA7IILMbI2i_1YfERkKWIrpHyA",
            authDomain: "ek-police.firebaseapp.com",
            projectId: "ek-police",
            storageBucket: "ek-police.firebasestorage.app",
            messagingSenderId: "300605258409",
            appId: "1:300605258409:web:f265025ffa5592f651c7b8"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.fb = { db, collection, onSnapshot, setDoc, doc, deleteDoc, query, orderBy, addDoc, updateDoc, serverTimestamp };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const RANK_DATA = [
            { id: 'General', weight: 19 }, { id: 'Lieutenant General', weight: 18 },
            { id: 'Major General', weight: 17 }, { id: 'Brigadier General', weight: 16 },
            { id: 'Colonel', weight: 15 }, { id: 'Major', weight: 14 },
            { id: 'Captain', weight: 13 }, { id: 'First Lieutenant', weight: 12 },
            { id: 'Lieutenant', weight: 11 }, { id: 'Staff Sergeant', weight: 10 },
            { id: 'First Sergeant', weight: 9 }, { id: 'Sergeant', weight: 8 },
            { id: 'Senior Officer', weight: 7 }, { id: 'Officer III', weight: 6 },
            { id: 'Officer II', weight: 5 }, { id: 'Officer I', weight: 4 },
            { id: 'Officer', weight: 3 }, { id: 'Solo Cadet', weight: 2 },
            { id: 'Cadet', weight: 1 }
        ];

        const App = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [user, setUser] = useState(null);
            const [page, setPage] = useState('dashboard');
            const [dbData, setDbData] = useState({ users: [], criminals: [], reports: [] });
            const [forms, setForms] = useState({ login: {}, report: {}, admin: {rank: 'Cadet'} });

            useEffect(() => {
                if (!window.fb) return;
                window.fb.onSnapshot(window.fb.collection(window.fb.db, "users"), s => setDbData(prev => ({...prev, users: s.docs.map(d=>d.data())})));
                window.fb.onSnapshot(window.fb.collection(window.fb.db, "criminals"), s => setDbData(prev => ({...prev, criminals: s.docs.map(d=>({...d.data(), fid: d.id}))})));
                const q = window.fb.query(window.fb.collection(window.fb.db, "field_reports"), window.fb.orderBy("createdAt", "desc"));
                window.fb.onSnapshot(q, s => setDbData(prev => ({...prev, reports: s.docs.map(d=>({...d.data(), fid: d.id}))})));
            }, []);

            const isLeader = (u) => u?.id === '1001' || u?.role === 'ÿ±ÿ™ÿ®ÿ© ŸÇŸäÿßÿØŸäÿ©';
            
            const sortedForce = useMemo(() => {
                return [...dbData.users].sort((a,b) => (RANK_DATA.find(r=>r.id===b.rank)?.weight || 0) - (RANK_DATA.find(r=>r.id===a.rank)?.weight || 0));
            }, [dbData.users]);

            const handleLogin = () => {
                const found = dbData.users.find(u => u.id === forms.login.id && u.password === forms.login.pass);
                if (found) { setUser(found); setIsLoggedIn(true); } else alert('ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©');
            };

            const NavIcon = ({id, icon, label}) => (
                <button onClick={()=>setPage(id)} className={`flex flex-col md:flex-row items-center justify-center gap-3 p-3 md:px-6 md:py-4 transition-all ${page === id ? 'nav-btn-active' : 'text-slate-500 hover:text-white'}`}>
                    <span className="text-xl">{icon}</span>
                    <span className="text-[10px] md:text-sm font-bold tracking-wide">{label}</span>
                </button>
            );

            if (!isLoggedIn) return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="glass-panel w-full max-w-md p-10 rounded-[30px] text-center border border-white/10">
                        <img src="ÿ±ÿßÿ®ÿ∑_ÿ¥ÿπÿßÿ±ŸÉ_ŸáŸÜÿß" className="w-40 h-40 mx-auto mb-8 drop-shadow-[0_0_15px_rgba(59,130,246,0.5)]" />
                        <h2 className="text-2xl font-extrabold tracking-tighter mb-8 bg-gradient-to-r from-white to-blue-400 bg-clip-text text-transparent">ÿ®Ÿàÿßÿ®ÿ© ÿßŸÑŸÜÿ∏ÿßŸÖ ÿßŸÑŸÖŸàÿ≠ÿØ</h2>
                        <div className="space-y-4">
                            <input type="text" placeholder="ÿßŸÑÿ±ŸÇŸÖ ÿßŸÑÿπÿ≥ŸÉÿ±Ÿä" className="w-full bg-slate-900/50 p-4 rounded-2xl text-center border border-white/5 focus:ring-2 ring-blue-500/20" onChange={e=>setForms({...forms, login:{...forms.login, id:e.target.value}})} />
                            <input type="password" placeholder="ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±" className="w-full bg-slate-900/50 p-4 rounded-2xl text-center border border-white/5 focus:ring-2 ring-blue-500/20" onChange={e=>setForms({...forms, login:{...forms.login, pass:e.target.value}})} />
                            <button onClick={handleLogin} className="w-full bg-blue-600 hover:bg-blue-500 py-4 rounded-2xl font-black text-white shadow-xl shadow-blue-900/40 transition-all active:scale-95">ÿØÿÆŸàŸÑ ÿßŸÑŸÖÿ±ŸÉÿ≤</button>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="flex flex-col md:flex-row min-h-screen">
                    {/* Sidebar Desktop */}
                    <aside className="desktop-sidebar glass-panel flex flex-col p-6">
                        <div className="text-center mb-10">
                            <img src="ÿ±ÿßÿ®ÿ∑_ÿ¥ÿπÿßÿ±ŸÉ_ŸáŸÜÿß" className="w-20 h-20 mx-auto mb-4" />
                            <p className="text-[10px] font-black text-blue-500 tracking-[0.3em] uppercase">Tactical MDT</p>
                        </div>
                        <nav className="space-y-2 flex-grow">
                            <NavIcon id="dashboard" icon="üìä" label="ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ" />
                            <NavIcon id="reports" icon="üìÅ" label="ÿ≥ÿ¨ŸÑ ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±" />
                            <NavIcon id="force" icon="üë•" label="ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÇŸàÿ©" />
                            <NavIcon id="wanted" icon="‚ö†Ô∏è" label="ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ŸäŸÜ" />
                            {isLeader(user) && <NavIcon id="admin" icon="‚öôÔ∏è" label="ÿßŸÑÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿπŸÑŸäÿß" />}
                        </nav>
                        <div className="mt-auto pt-6 border-t border-white/5 flex items-center gap-4">
                            <div className="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center font-bold">{user.name[0]}</div>
                            <div className="text-xs">
                                <p className="font-bold">{user.name}</p>
                                <button onClick={()=>setIsLoggedIn(false)} className="text-red-400 hover:text-red-300">ÿÆÿ±Ÿàÿ¨</button>
                            </div>
                        </div>
                    </aside>

                    {/* Mobile Bottom Nav */}
                    <nav className="mobile-bottom-nav px-4 flex justify-around items-center">
                        <NavIcon id="dashboard" icon="üìä" label="ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©" />
                        <NavIcon id="reports" icon="üìÅ" label="ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±" />
                        <NavIcon id="force" icon="üë•" label="ÿßŸÑŸÇŸàÿ©" />
                        <NavIcon id="wanted" icon="‚ö†Ô∏è" label="ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ŸäŸÜ" />
                        {isLeader(user) && <NavIcon id="admin" icon="‚öôÔ∏è" label="ÿßŸÑÿ•ÿØÿßÿ±ÿ©" />}
                    </nav>

                    {/* Main Area */}
                    <main className="content-area flex-grow overflow-y-auto">
                        <div className="page-entry">
                            <div className="flex justify-between items-center mb-10">
                                <h1 className="text-3xl md:text-5xl font-black italic tracking-tighter">
                                    {page === 'dashboard' && 'OVERVIEW'}
                                    {page === 'reports' && 'FIELD REPORTS'}
                                    {page === 'force' && 'FORCE REGISTER'}
                                    {page === 'wanted' && 'WANTED LIST'}
                                    {page === 'admin' && 'ADMIN CENTER'}
                                </h1>
                                <div className="text-right desktop-only">
                                    <p className="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Current Status</p>
                                    <p className="text-green-500 font-bold text-xs flex items-center gap-2">‚óè SYSTEM ACTIVE</p>
                                </div>
                            </div>

                            {/* Dashboard */}
                            {page === 'dashboard' && (
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className="glass-panel p-8 rounded-[30px] tactical-card">
                                        <p className="text-xs font-bold text-slate-500 mb-2">ÿßŸÑŸÇŸàÿ© ÿßŸÑÿπÿßŸÖŸÑÿ©</p>
                                        <h2 className="text-6xl font-black">{dbData.users.length}</h2>
                                    </div>
                                    <div className="glass-panel p-8 rounded-[30px] tactical-card border-r-red-500">
                                        <p className="text-xs font-bold text-slate-500 mb-2">ÿ™ÿπŸÖŸäŸÖÿßÿ™ ŸÜÿ¥ÿ∑ÿ©</p>
                                        <h2 className="text-6xl font-black text-red-500">{dbData.criminals.length}</h2>
                                    </div>
                                    <div className="glass-panel p-8 rounded-[30px] tactical-card border-r-blue-500">
                                        <p className="text-xs font-bold text-slate-500 mb-2">ÿ™ŸÇÿßÿ±Ÿäÿ± ÿßŸÑŸäŸàŸÖ</p>
                                        <h2 className="text-6xl font-black text-blue-500">{dbData.reports.length}</h2>
                                    </div>
                                </div>
                            )}

                            {/* Force List */}
                            {page === 'force' && (
                                <div className="glass-panel rounded-[30px] overflow-hidden border border-white/5">
                                    <table className="w-full text-right">
                                        <thead className="bg-white/5 text-[10px] text-slate-400 font-bold uppercase tracking-widest">
                                            <tr><th className="p-6">ÿßŸÑÿ±ÿ™ÿ®ÿ© ÿßŸÑÿπÿ≥ŸÉÿ±Ÿäÿ©</th><th className="p-6">ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ</th><th className="p-6">ÿßŸÑÿ±ŸÇŸÖ</th></tr>
                                        </thead>
                                        <tbody className="divide-y divide-white/5">
                                            {sortedForce.map(u => (
                                                <tr key={u.id} className="hover:bg-white/5 transition-colors">
                                                    <td className="p-6 text-blue-400 font-bold text-sm tracking-tighter">
                                                        <span className="bg-blue-500/10 px-3 py-1 rounded-full">{u.rank}</span>
                                                    </td>
                                                    <td className="p-6 font-bold">{u.name}</td>
                                                    <td className="p-6 font-mono text-slate-500 text-xs">{u.id}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            )}

                            {/* Reports */}
                            {page === 'reports' && (
                                <div className="grid gap-6 max-w-4xl mx-auto">
                                    <div className="glass-panel p-8 rounded-[30px] border-r-4 border-r-blue-500">
                                        <h3 className="font-bold mb-6 text-blue-400 flex items-center gap-2"><span>‚úö</span> ÿ•ÿ∂ÿßŸÅÿ© ÿ®ŸÑÿßÿ∫ ÿ¨ÿØŸäÿØ</h3>
                                        <div className="space-y-4">
                                            <input type="text" placeholder="ÿßŸÑŸàŸÇÿ™ (ŸÖÿ´ŸÑÿßŸã 02:00 AM)" className="w-full bg-black/20 p-4 rounded-xl" value={forms.report.time || ''} onChange={e=>setForms({...forms, report:{...forms.report, time:e.target.value}})} />
                                            <textarea placeholder="ÿßŸÉÿ™ÿ® ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖÿ®ÿßÿ¥ÿ±ÿ© ŸáŸÜÿß..." className="w-full bg-black/20 p-4 rounded-xl h-32" value={forms.report.content || ''} onChange={e=>setForms({...forms, report:{...forms.report, content:e.target.value}})}></textarea>
                                            <button onClick={async()=>{
                                                await window.fb.addDoc(window.fb.collection(window.fb.db, "field_reports"), {...forms.report, authorName: user.name, authorId: user.id, createdAt: window.fb.serverTimestamp()});
                                                setForms({...forms, report:{}});
                                            }} className="w-full bg-blue-600 py-4 rounded-xl font-black">ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ŸÑŸÑÿ£ÿ±ÿ¥ŸäŸÅ</button>
                                        </div>
                                    </div>
                                    {dbData.reports.map(r => (
                                        <div key={r.fid} className="glass-panel p-6 rounded-[25px] border-white/5 relative overflow-hidden">
                                            <div className="flex justify-between items-start mb-4">
                                                <div className="flex items-center gap-3">
                                                    <div className="w-8 h-8 rounded bg-blue-500/20 flex items-center justify-center text-[10px] font-bold text-blue-400">{r.authorId}</div>
                                                    <div><p className="text-sm font-bold">{r.authorName}</p><p className="text-[10px] text-slate-500">{r.incidentTime}</p></div>
                                                </div>
                                            </div>
                                            <p className="text-sm leading-relaxed text-slate-300 pr-4 border-r border-blue-500/30">{r.content}</p>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Wanted */}
                            {page === 'wanted' && (
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {dbData.criminals.map(c => (
                                        <div key={c.fid} className="glass-panel p-6 rounded-[25px] border-r-4 border-r-red-600 flex justify-between items-center group">
                                            <div>
                                                <h4 className="text-xl font-black text-red-500 uppercase tracking-tighter">{c.name}</h4>
                                                <p className="text-xs font-bold text-slate-500">{c.crime}</p>
                                            </div>
                                            {isLeader(user) && <button onClick={async()=>await window.fb.deleteDoc(window.fb.doc(window.fb.db, "criminals", c.fid))} className="text-[10px] text-red-500 font-bold bg-red-500/10 px-4 py-2 rounded-full hover:bg-red-500 hover:text-white transition-all">ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÖŸÑŸÅ</button>}
                                        </div>
                                    ))}
                                </div>
                            )}

                            {/* Admin */}
                            {page === 'admin' && (
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-10">
                                    <div className="glass-panel p-8 rounded-[30px] border-r-4 border-r-amber-500">
                                        <h3 className="font-bold mb-6 text-amber-500 uppercase text-xs tracking-widest">ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸàÿßÿ±ÿØ ÿßŸÑÿ®ÿ¥ÿ±Ÿäÿ©</h3>
                                        <div className="space-y-3">
                                            <input type="text" placeholder="ÿßŸÑÿ±ŸÇŸÖ ÿßŸÑÿπÿ≥ŸÉÿ±Ÿä" className="w-full bg-black/20 p-4 rounded-xl" onChange={e=>setForms({...forms, admin:{...forms.admin, id:e.target.value}})} />
                                            <input type="text" placeholder="ÿßŸÑÿßÿ≥ŸÖ" className="w-full bg-black/20 p-4 rounded-xl" onChange={e=>setForms({...forms, admin:{...forms.admin, name:e.target.value}})} />
                                            <input type="password" placeholder="ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±" className="w-full bg-black/20 p-4 rounded-xl" onChange={e=>setForms({...forms, admin:{...forms.admin, password:e.target.value}})} />
                                            <select className="w-full bg-slate-900 p-4 rounded-xl" onChange={e=>setForms({...forms, admin:{...forms.admin, rank:e.target.value}})}>
                                                {RANK_DATA.map(r => <option key={r.id} value={r.id}>{r.id}</option>)}
                                            </select>
                                            <button onClick={async()=>{
                                                await window.fb.setDoc(window.fb.doc(window.fb.db, "users", forms.admin.id), forms.admin);
                                                alert('ÿ™ŸÖ ÿßŸÑÿ™ÿ≠ÿØŸäÿ´');
                                            }} className="w-full bg-amber-600 py-4 rounded-xl font-black shadow-lg">ÿ™ÿ≠ÿØŸäÿ´ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÇŸàÿ©</button>
                                        </div>
                                    </div>
                                    <div className="space-y-3">
                                        {dbData.users.map(u => (
                                            <div key={u.id} className="glass-panel p-4 rounded-2xl flex justify-between items-center text-xs">
                                                <span>{u.name} <b className="text-blue-500 ml-2">{u.rank}</b></span>
                                                <button onClick={async()=>await window.fb.deleteDoc(window.fb.doc(window.fb.db, "users", u.id))} className="text-red-500 font-bold">ÿ≠ÿ∞ŸÅ</button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    </main>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
