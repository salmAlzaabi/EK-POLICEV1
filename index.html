<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© | MOI System v3.0</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700;900&display=swap');
        * { font-family: 'Cairo', sans-serif; margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: radial-gradient(circle at top, #1e293b 0%, #0f172a 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }
        .glass-card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 10px; }
        .animate-fadeIn { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
        import { 
            getFirestore, collection, addDoc, setDoc, doc, 
            onSnapshot, deleteDoc, query, orderBy 
        } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCYgffN2dA7IILMbI2i_1YfERkKWIrpHyA",
            authDomain: "ek-police.firebaseapp.com",
            projectId: "ek-police",
            storageBucket: "ek-police.firebasestorage.app",
            messagingSenderId: "300605258409",
            appId: "1:300605258409:web:f265025ffa5592f651c7b8",
            measurementId: "G-ECHK86Q5PK"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.fb = { db, collection, addDoc, setDoc, doc, onSnapshot, deleteDoc, query, orderBy };
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const Icon = ({ name, className = "" }) => {
            const icons = {
                shield: "ğŸ›¡ï¸", search: "ğŸ”", plus: "â•", users: "ğŸ‘¥",
                home: "ğŸ ", logout: "ğŸšª", userCog: "âš™ï¸", userPlus: "ğŸ‘¤â•",
                trash: "ğŸ—‘ï¸", edit: "âœï¸", table: "ğŸ“…", check: "âœ…", alert: "âš ï¸"
            };
            return <span className={className}>{icons[name] || "â€¢"}</span>;
        };

        const App = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [currentUser, setCurrentUser] = useState(null);
            const [loading, setLoading] = useState(true);
            const [currentPage, setCurrentPage] = useState('dashboard');
            
            const [users, setUsers] = useState([]);
            const [criminals, setCriminals] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            
            // User Form States
            const [isEditing, setIsEditing] = useState(false);
            const [loginForm, setLoginForm] = useState({ id: '', password: '' });
            const [newUser, setNewUser] = useState({ 
                id: '', password: '', name: '', role: 'Ø¬Ù†Ø¯ÙŠ', rank: 'Cadet', department: '' 
            });
            const [newCriminal, setNewCriminal] = useState({ name: '', crime: '', danger: 'Ù…ØªÙˆØ³Ø·' });

            // Real-time Sync
            useEffect(() => {
                if (!window.fb) return;
                const unsubU = window.fb.onSnapshot(window.fb.collection(window.fb.db, "users"), (snap) => {
                    setUsers(snap.docs.map(d => ({ ...d.data(), fbId: d.id })));
                    setLoading(false);
                });
                const unsubC = window.fb.onSnapshot(
                    window.fb.query(window.fb.collection(window.fb.db, "criminals"), window.fb.orderBy("timestamp", "desc")),
                    (snap) => setCriminals(snap.docs.map(d => ({ ...d.data(), fbId: d.id })))
                );
                return () => { unsubU(); unsubC(); };
            }, []);

            const handleLogin = () => {
                const user = users.find(u => u.id === loginForm.id && u.password === loginForm.password);
                if (user) { setCurrentUser(user); setIsLoggedIn(true); } 
                else { alert('Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©'); }
            };

            // User Management Actions
            const saveUser = async () => {
                if (!newUser.id || !newUser.name || !newUser.department) return alert('ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© ÙƒØ§ÙØ© Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ø§Ù„Ù‚Ø³Ù…');
                try {
                    await window.fb.setDoc(window.fb.doc(window.fb.db, "users", newUser.id), newUser);
                    setNewUser({ id: '', password: '', name: '', role: 'Ø¬Ù†Ø¯ÙŠ', rank: 'Cadet', department: '' });
                    setIsEditing(false);
                    alert(isEditing ? 'âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ' : 'âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ Ø¨Ù†Ø¬Ø§Ø­');
                } catch (e) { alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©'); }
            };

            const startEdit = (user) => {
                setNewUser(user);
                setIsEditing(true);
                setCurrentPage('users');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const deleteUser = async (id) => {
                if (id === currentUser.id) return alert('Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ùƒ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…');
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ')) {
                    await window.fb.deleteDoc(window.fb.doc(window.fb.db, "users", id));
                }
            };

            // Criminal Actions
            const addCriminal = async () => {
                if (!newCriminal.name || !newCriminal.crime) return alert('Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨');
                await window.fb.addDoc(window.fb.collection(window.fb.db, "criminals"), {
                    ...newCriminal, date: new Date().toLocaleDateString('ar-SA'), timestamp: new Date().getTime()
                });
                setNewCriminal({ name: '', crime: '', danger: 'Ù…ØªÙˆØ³Ø·' });
            };

            if (loading) return (
                <div className="h-screen flex flex-col items-center justify-center bg-[#0f172a]">
                    <div className="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"></div>
                    <h2 className="text-xl font-bold tracking-widest text-blue-400">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ©...</h2>
                </div>
            );

            if (!isLoggedIn) return (
                <div className="min-h-screen flex items-center justify-center p-6 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]">
                    <div className="glass-card p-10 rounded-3xl w-full max-w-md border-t-4 border-t-blue-600">
                        <div className="text-center mb-10">
                            <Icon name="shield" className="text-6xl mb-4 inline-block" />
                            <h1 className="text-3xl font-black text-white">ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©</h1>
                            <p className="text-blue-400 text-xs tracking-[0.3em] mt-2">MINISTRY OF INTERIOR</p>
                        </div>
                        <div className="space-y-6">
                            <div className="space-y-2">
                                <label className="text-xs text-gray-400 mr-2">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ</label>
                                <input type="text" placeholder="Military ID" className="w-full p-4 rounded-xl bg-slate-900 border border-slate-700 focus:border-blue-500 outline-none transition-all" onChange={e => setLoginForm({...loginForm, id: e.target.value})} />
                            </div>
                            <div className="space-y-2">
                                <label className="text-xs text-gray-400 mr-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                                <input type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" className="w-full p-4 rounded-xl bg-slate-900 border border-slate-700 focus:border-blue-500 outline-none transition-all" onChange={e => setLoginForm({...loginForm, password: e.target.value})} onKeyPress={e => e.key === 'Enter' && handleLogin()} />
                            </div>
                            <button onClick={handleLogin} className="w-full bg-blue-600 hover:bg-blue-700 py-4 rounded-xl font-bold text-lg shadow-xl shadow-blue-900/40 transition-all active:scale-95">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen flex flex-col">
                    {/* Header */}
                    <header className="bg-slate-900/80 backdrop-blur-md p-4 border-b border-blue-900/30 sticky top-0 z-50">
                        <div className="container mx-auto flex justify-between items-center">
                            <div className="flex items-center gap-3">
                                <div className="bg-blue-600 p-2 rounded-lg shadow-lg shadow-blue-600/20"><Icon name="shield" className="text-2xl" /></div>
                                <div>
                                    <h1 className="font-black text-lg leading-tight">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h1>
                                    <p className="text-[10px] text-green-400 flex items-center gap-1">
                                        <span className="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></span> Ø§ØªØµØ§Ù„ Ø¢Ù…Ù† Ù†Ø´Ø·
                                    </p>
                                </div>
                            </div>
                            <div className="flex items-center gap-4">
                                <div className="text-left hidden sm:block">
                                    <p className="text-sm font-bold">{currentUser.name}</p>
                                    <p className="text-[10px] text-blue-400 tracking-wider uppercase">{currentUser.rank} | {currentUser.department}</p>
                                </div>
                                <button onClick={() => setIsLoggedIn(false)} className="bg-red-500/10 text-red-500 p-2.5 rounded-xl hover:bg-red-500 hover:text-white transition-all"><Icon name="logout" /></button>
                            </div>
                        </div>
                    </header>

                    {/* Navigation */}
                    <nav className="container mx-auto p-4 overflow-x-auto no-scrollbar">
                        <div className="flex gap-3 min-w-max">
                            <button onClick={() => setCurrentPage('dashboard')} className={`flex items-center gap-2 px-6 py-3 rounded-2xl transition-all ${currentPage === 'dashboard' ? 'bg-blue-600 shadow-lg shadow-blue-600/30' : 'glass-card'}`}><Icon name="home" /> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
                            <button onClick={() => setCurrentPage('schedule')} className={`flex items-center gap-2 px-6 py-3 rounded-2xl transition-all ${currentPage === 'schedule' ? 'bg-blue-600 shadow-lg shadow-blue-600/30' : 'glass-card'}`}><Icon name="table" /> Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ</button>
                            <button onClick={() => setCurrentPage('criminals')} className={`flex items-center gap-2 px-6 py-3 rounded-2xl transition-all ${currentPage === 'criminals' ? 'bg-blue-600 shadow-lg shadow-blue-600/30' : 'glass-card'}`}><Icon name="users" /> Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†</button>
                            {currentUser.role === 'Ù‚Ø§Ø¦Ø¯' && (
                                <button onClick={() => setCurrentPage('users')} className={`flex items-center gap-2 px-6 py-3 rounded-2xl transition-all ${currentPage === 'users' ? 'bg-purple-600 shadow-lg shadow-purple-600/30' : 'glass-card'}`}><Icon name="userCog" /> Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
                            )}
                        </div>
                    </nav>

                    <main className="container mx-auto p-4 flex-grow animate-fadeIn">
                        {/* Page: Dashboard */}
                        {currentPage === 'dashboard' && (
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div className="glass-card p-8 rounded-[2.5rem] relative overflow-hidden group">
                                    <Icon name="users" className="text-9xl absolute -bottom-6 -right-6 opacity-5 group-hover:scale-110 transition-transform" />
                                    <h3 className="text-gray-400 font-bold mb-1">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙˆØ©</h3>
                                    <p className="text-6xl font-black">{users.length}</p>
                                </div>
                                <div className="glass-card p-8 rounded-[2.5rem] border-b-4 border-b-red-500 relative overflow-hidden group">
                                    <Icon name="alert" className="text-9xl absolute -bottom-6 -right-6 opacity-5 group-hover:scale-110 transition-transform" />
                                    <h3 className="text-gray-400 font-bold mb-1">Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ÙŠÙ† Ø£Ù…Ù†ÙŠØ§Ù‹</h3>
                                    <p className="text-6xl font-black text-red-500">{criminals.length}</p>
                                </div>
                                <div className="glass-card p-8 rounded-[2.5rem] border-b-4 border-b-blue-500">
                                    <h3 className="text-gray-400 font-bold mb-1">Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù†Ø´Ø·Ø©</h3>
                                    <p className="text-6xl font-black">{[...new Set(users.map(u => u.department))].filter(Boolean).length}</p>
                                </div>
                            </div>
                        )}

                        {/* Page: Military Schedule (Public) */}
                        {currentPage === 'schedule' && (
                            <div className="max-w-5xl mx-auto">
                                <div className="flex items-center gap-3 mb-6">
                                    <Icon name="table" className="text-3xl text-blue-500" />
                                    <h2 className="text-2xl font-black">Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ Ø§Ù„Ø¹Ø§Ù…</h2>
                                </div>
                                <div className="glass-card rounded-3xl overflow-hidden border border-white/5 shadow-2xl">
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-right border-collapse">
                                            <thead>
                                                <tr className="bg-blue-600 text-white">
                                                    <th className="p-5 text-sm font-bold uppercase">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</th>
                                                    <th className="p-5 text-sm font-bold uppercase">Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ</th>
                                                    <th className="p-5 text-sm font-bold uppercase">Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</th>
                                                    <th className="p-5 text-sm font-bold uppercase">Ø§Ù„Ù‚Ø³Ù… / Ø§Ù„ÙˆØ­Ø¯Ø©</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-white/5">
                                                {users.map(u => (
                                                    <tr key={u.id} className="hover:bg-blue-500/5 transition-colors">
                                                        <td className="p-5 font-bold">{u.name}</td>
                                                        <td className="p-5 font-mono text-blue-400">{u.id}</td>
                                                        <td className="p-5 text-gray-300">{u.rank}</td>
                                                        <td className="p-5 font-bold text-purple-400">{u.department}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Page: Admin User Management (Commander only) */}
                        {currentPage === 'users' && currentUser.role === 'Ù‚Ø§Ø¦Ø¯' && (
                            <div className="max-w-4xl mx-auto space-y-8">
                                <div className="glass-card p-8 rounded-3xl border-2 border-purple-500/20">
                                    <h2 className="text-2xl font-bold text-purple-400 mb-6 flex items-center gap-2">
                                        {isEditing ? <Icon name="edit" /> : <Icon name="userPlus" />}
                                        {isEditing ? `ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ: ${newUser.id}` : 'Ø¥Ø¶Ø§ÙØ© ÙØ±Ø¯ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù‚ÙˆØ© Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ©'}
                                    </h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-5">
                                        <div className="space-y-2">
                                            <label className="text-xs text-gray-400 mr-1">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ (ID)</label>
                                            <input type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹: 1001" disabled={isEditing} value={newUser.id} className={`w-full p-4 rounded-xl bg-slate-900 border border-slate-700 ${isEditing ? 'opacity-50' : ''}`} onChange={e=>setNewUser({...newUser, id: e.target.value})} />
                                        </div>
                                        <div className="space-y-2">
                                            <label className="text-xs text-gray-400 mr-1">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</label>
                                            <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ" value={newUser.name} className="w-full p-4 rounded-xl bg-slate-900 border border-slate-700" onChange={e=>setNewUser({...newUser, name: e.target.value})} />
                                        </div>
                                        <div className="space-y-2">
                                            <label className="text-xs text-gray-400 mr-1">Ø§Ù„Ù‚Ø³Ù… / Ø§Ù„ÙˆØ­Ø¯Ø©</label>
                                            <input type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„Ø¯ÙˆØ±ÙŠØ§Øª Ø§Ù„Ø£Ù…Ù†ÙŠØ©" value={newUser.department} className="w-full p-4 rounded-xl bg-slate-900 border border-purple-900/40" onChange={e=>setNewUser({...newUser, department: e.target.value})} />
                                        </div>
                                        <div className="space-y-2">
                                            <label className="text-xs text-gray-400 mr-1">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                                            <input type="text" placeholder="Ø§ØªØ±ÙƒÙ‡Ø§ Ø¥Ø°Ø§ Ù„Ù… ØªØ±Ø¯ ØªØºÙŠÙŠØ±Ù‡Ø§" value={newUser.password} className="w-full p-4 rounded-xl bg-slate-900 border border-slate-700" onChange={e=>setNewUser({...newUser, password: e.target.value})} />
                                        </div>
                                        <div className="space-y-2">
                                            <label className="text-xs text-gray-400 mr-1">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</label>
                                            <select className="w-full p-4 rounded-xl bg-slate-900 border border-slate-700" value={newUser.role} onChange={e=>setNewUser({...newUser, role: e.target.value})}>
                                                <option value="Ø¬Ù†Ø¯ÙŠ">Ø¬Ù†Ø¯ÙŠ</option><option value="Ø¶Ø§Ø¨Ø·">Ø¶Ø§Ø¨Ø·</option><option value="Ù‚Ø§Ø¦Ø¯">Ù‚Ø§Ø¦Ø¯</option>
                                            </select>
                                        </div>
                                        <div className="space-y-2">
                                            <label className="text-xs text-gray-400 mr-1">Ø§Ù„Ø±ØªØ¨Ø©</label>
                                            <select className="w-full p-4 rounded-xl bg-slate-900 border border-slate-700" value={newUser.rank} onChange={e=>setNewUser({...newUser, rank: e.target.value})}>
                                                <option value="Cadet">Cadet</option><option value="Solo Cadet">Solo Cadet</option><option value="Officer">Officer</option><option value="Officer I">Officer I</option><option value="Officer II">Officer II</option><option value="Officer III">Officer III</option><option value="Senior Officer">Senior Officer</option><option value="Sergeant">Sergeant</option><option value="First Sergeant">First Sergeant</option><option value="Staff Sergeant">Staff Sergeant</option><option value="Lieutenant">Lieutenant</option><option value="First Lieutenant">First Lieutenant</option><option value="Captain">Captain</option><option value="Major">Major</option><option value="Colonel">Colonel</option><option value="Brigadier General">Brigadier General</option><option value="Major General">Major General</option><option value="Lieutenant General">Lieutenant General</option><option value="General">General</option>
                                            </select>
                                        </div>
                                        <div className="md:col-span-2 flex gap-3 mt-4">
                                            <button onClick={saveUser} className="flex-grow bg-purple-600 hover:bg-purple-700 py-4 rounded-xl font-black transition-all shadow-lg shadow-purple-900/30">
                                                {isEditing ? 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†' : 'Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„ÙØ±Ø¯ ÙÙŠ Ø§Ù„Ù‚ÙˆØ©'}
                                            </button>
                                            {isEditing && (
                                                <button onClick={() => {setIsEditing(false); setNewUser({id:'', name:'', department:'', password:'', role:'Ø¬Ù†Ø¯ÙŠ', rank:'Cadet'});}} className="bg-slate-700 px-8 rounded-xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
                                            )}
                                        </div>
                                    </div>
                                </div>

                                <div className="grid gap-4">
                                    <h3 className="text-gray-400 font-bold px-2">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø© ({users.length})</h3>
                                    {users.map(u => (
                                        <div key={u.id} className="glass-card p-5 rounded-2xl flex justify-between items-center group hover:bg-white/5 transition-all">
                                            <div className="flex items-center gap-4">
                                                <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center font-black text-xl">{u.name[0]}</div>
                                                <div>
                                                    <p className="font-black text-lg">{u.name}</p>
                                                    <p className="text-xs text-gray-400">{u.rank} â€¢ <span className="text-purple-400 font-bold">{u.department}</span></p>
                                                    <p className="text-[10px] text-gray-500 mt-1 uppercase tracking-widest font-mono">Military ID: {u.id}</p>
                                                </div>
                                            </div>
                                            <div className="flex gap-2">
                                                <button onClick={() => startEdit(u)} className="p-3 bg-blue-500/10 text-blue-500 rounded-xl hover:bg-blue-500 hover:text-white transition-all"><Icon name="edit" /></button>
                                                <button onClick={() => deleteUser(u.id)} className="p-3 bg-red-500/10 text-red-500 rounded-xl hover:bg-red-500 hover:text-white transition-all"><Icon name="trash" /></button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Page: Criminals */}
                        {currentPage === 'criminals' && (
                            <div className="max-w-4xl mx-auto space-y-6">
                                {(currentUser.role === 'Ø¶Ø§Ø¨Ø·' || currentUser.role === 'Ù‚Ø§Ø¦Ø¯') && (
                                    <div className="glass-card p-6 rounded-3xl space-y-4 border-r-4 border-r-red-600">
                                        <h2 className="text-xl font-bold text-red-500 flex items-center gap-2"><Icon name="alert" /> Ø¥Ø¶Ø§ÙØ© Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„ØªØ¹Ù…ÙŠÙ…</h2>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <input type="text" placeholder="Ø§Ù„Ø§Ø³Ù…" className="p-4 rounded-xl bg-slate-900 border border-slate-700" value={newCriminal.name} onChange={e=>setNewCriminal({...newCriminal, name: e.target.value})} />
                                            <input type="text" placeholder="Ø§Ù„Ø¬Ø±ÙŠÙ…Ø©" className="p-4 rounded-xl bg-slate-900 border border-slate-700" value={newCriminal.crime} onChange={e=>setNewCriminal({...newCriminal, crime: e.target.value})} />
                                            <select className="p-4 rounded-xl bg-slate-900 border border-slate-700 text-red-500 font-bold" value={newCriminal.danger} onChange={e=>setNewCriminal({...newCriminal, danger: e.target.value})}>
                                                <option>Ù…ØªÙˆØ³Ø·</option><option>Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø®Ø·ÙˆØ±Ø©</option><option>Ø¥Ø±Ù‡Ø§Ø¨</option>
                                            </select>
                                            <button onClick={addCriminal} className="md:col-span-3 bg-red-600 hover:bg-red-700 p-4 rounded-xl font-black shadow-lg shadow-red-900/30">ØªØ¹Ù…ÙŠÙ… ÙÙˆØ±ÙŠ</button>
                                        </div>
                                    </div>
                                )}
                                
                                <div className="relative">
                                    <Icon name="search" className="absolute right-4 top-1/2 -translate-y-1/2 text-gray-500" />
                                    <input type="text" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠ..." className="w-full p-5 pr-12 rounded-2xl glass-card focus:border-blue-500 outline-none" onChange={e => setSearchTerm(e.target.value)} />
                                </div>

                                <div className="grid gap-4">
                                    {criminals.filter(c => c.name.includes(searchTerm)).map(c => (
                                        <div key={c.fbId} className="glass-card p-6 rounded-2xl flex justify-between items-center border-l-4 border-l-red-600 group transition-all">
                                            <div>
                                                <div className="flex items-center gap-2 mb-1">
                                                    <span className="w-2 h-2 bg-red-600 rounded-full animate-pulse"></span>
                                                    <h3 className="font-black text-xl">{c.name}</h3>
                                                </div>
                                                <p className="text-sm text-gray-400">{c.crime} â€¢ <span className="text-red-500 font-bold uppercase">{c.danger}</span></p>
                                                <p className="text-[10px] text-gray-600 mt-1">Ø³Ø¬Ù„ Ø¨ØªØ§Ø±ÙŠØ®: {c.date}</p>
                                            </div>
                                            {(currentUser.role === 'Ø¶Ø§Ø¨Ø·' || currentUser.role === 'Ù‚Ø§Ø¦Ø¯') && (
                                                <button onClick={async () => { if(confirm('Ø­Ø°ÙØŸ')) await window.fb.deleteDoc(window.fb.doc(window.fb.db, "criminals", c.fbId)) }} className="text-red-500 p-3 bg-red-500/10 rounded-xl opacity-0 group-hover:opacity-100 transition-opacity"><Icon name="trash" /></button>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </main>

                    <footer className="p-8 text-center text-gray-600 text-[10px] tracking-[0.5em] uppercase font-bold">
                        Ministry of Interior â€¢ Classified Information â€¢ 2026
                    </footer>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
