<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MDT | Ù†Ø¸Ø§Ù… ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© Ø§Ù„Ù…Ø·ÙˆØ±</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@300;500;700;900&display=swap');
        
        body { 
            font-family: 'Noto Kufi Arabic', sans-serif; 
            margin: 0;
            overflow: hidden;
            background: #f0f4f8;
            height: 100vh;
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
        #particles-js {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #e0e7ff 0%, #f1f5f9 100%);
            z-index: -1;
        }

        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø²Ø¬Ø§Ø¬ Ø§Ù„ÙØ§Ø®Ø± */
        .glass-ui {
            background: rgba(255, 255, 255, 0.45);
            backdrop-filter: blur(25px) saturate(180%);
            -webkit-backdrop-filter: blur(25px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 28px;
        }

        .sidebar-container {
            margin: 20px;
            height: calc(100vh - 40px);
            width: 280px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
        }

        .main-container {
            margin: 20px 20px 20px 0;
            height: calc(100vh - 40px);
            overflow-y: auto;
            scrollbar-width: none;
        }

        .nav-btn {
            transition: all 0.4s ease;
            margin: 10px 20px;
            border-radius: 20px;
            color: #475569;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: scale(1.05);
            color: #4f46e5;
        }

        .nav-active {
            background: white !important;
            color: #4f46e5 !important;
            font-weight: 900;
            box-shadow: 0 10px 25px rgba(79, 70, 229, 0.15);
        }

        .card-stat {
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .card-stat:hover {
            transform: translateY(-10px);
        }

        /* ØªØ®ØµÙŠØµ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª */
        input, select {
            background: rgba(255, 255, 255, 0.7) !important;
            border: 1px solid rgba(79, 70, 229, 0.1) !important;
            border-radius: 16px !important;
            padding: 12px 20px !important;
            transition: all 0.3s !important;
        }

        input:focus {
            background: white !important;
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1) !important;
        }

        .action-btn {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border-radius: 18px;
            font-weight: 700;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        }
    </style>
</head>
<body>
    <div id="particles-js"></div>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, setDoc, doc, deleteDoc, query, orderBy, addDoc } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCYgffN2dA7IILMbI2i_1YfERkKWIrpHyA",
            authDomain: "ek-police.firebaseapp.com",
            projectId: "ek-police",
            storageBucket: "ek-police.firebasestorage.app",
            messagingSenderId: "300605258409",
            appId: "1:300605258409:web:f265025ffa5592f651c7b8",
            measurementId: "G-ECHK86Q5PK"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.fb = { db, collection, onSnapshot, setDoc, doc, deleteDoc, query, orderBy, addDoc };

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©
        particlesJS("particles-js", {
            "particles": {
                "number": { "value": 80, "density": { "enable": true, "value_area": 800 } },
                "color": { "value": "#4f46e5" },
                "shape": { "type": "circle" },
                "opacity": { "value": 0.2, "random": false },
                "size": { "value": 3, "random": true },
                "line_linked": { "enable": true, "distance": 150, "color": "#4f46e5", "opacity": 0.1, "width": 1 },
                "move": { "enable": true, "speed": 2, "direction": "none", "random": false, "straight": false, "out_mode": "out", "bounce": false }
            },
            "interactivity": {
                "detect_on": "canvas",
                "events": { "onhover": { "enable": true, "mode": "grab" }, "onclick": { "enable": true, "mode": "push" }, "resize": true },
                "modes": { "grab": { "distance": 140, "line_linked": { "opacity": 1 } }, "push": { "particles_nb": 4 } }
            },
            "retina_detect": true
        });
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const RANK_HIERARCHY = [
            { id: 'General', weight: 19 }, { id: 'Lieutenant General', weight: 18 },
            { id: 'Major General', weight: 17 }, { id: 'Brigadier General', weight: 16 },
            { id: 'Colonel', weight: 15 }, { id: 'Major', weight: 14 },
            { id: 'Captain', weight: 13 }, { id: 'First Lieutenant', weight: 12 },
            { id: 'Lieutenant', weight: 11 }, { id: 'Staff Sergeant', weight: 10 },
            { id: 'First Sergeant', weight: 9 }, { id: 'Sergeant', weight: 8 },
            { id: 'Senior Officer', weight: 7 }, { id: 'Officer III', weight: 6 },
            { id: 'Officer II', weight: 5 }, { id: 'Officer I', weight: 4 },
            { id: 'Officer', weight: 3 }, { id: 'Solo Cadet', weight: 2 },
            { id: 'Cadet', weight: 1 }
        ];

        const App = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [currentUser, setCurrentUser] = useState(null);
            const [currentPage, setCurrentPage] = useState('dashboard');
            const [users, setUsers] = useState([]);
            const [criminals, setCriminals] = useState([]);
            const [isEditing, setIsEditing] = useState(false);

            const [loginForm, setLoginForm] = useState({ id: '', password: '' });
            const [newUser, setNewUser] = useState({ id: '', password: '', name: '', role: 'Ø±ØªØ¨Ø© ÙØ±Ø¯', rank: 'Cadet', department: '' });
            const [newCriminal, setNewCriminal] = useState({ name: '', crime: '', danger: 'Ù…ØªÙˆØ³Ø·' });

            useEffect(() => {
                if (!window.fb) return;
                const unsubU = window.fb.onSnapshot(window.fb.collection(window.fb.db, "users"), (snap) => {
                    setUsers(snap.docs.map(d => ({ ...d.data(), fbId: d.id })));
                });
                const unsubC = window.fb.onSnapshot(window.fb.collection(window.fb.db, "criminals"), (snap) => {
                    setCriminals(snap.docs.map(d => ({ ...d.data(), fbId: d.id })));
                });
                return () => { unsubU(); unsubC(); };
            }, []);

            const isCommand = (u) => u?.id === '1001' || u?.role === 'Ø±ØªØ¨Ø© Ù‚ÙŠØ§Ø¯ÙŠØ©';
            const isOfficer = (u) => isCommand(u) || u?.role === 'Ø±ØªØ¨Ø© Ø¶Ø§Ø¨Ø·';

            const handleLogin = () => {
                const u = users.find(x => x.id === loginForm.id && x.password === loginForm.password);
                if (u) { setCurrentUser(u); setIsLoggedIn(true); } else alert('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
            };

            if (!isLoggedIn) return (
                <div className="h-screen w-full flex items-center justify-center p-6 relative">
                    <div className="glass-ui w-full max-w-md p-10 text-center shadow-2xl">
                        <div className="w-20 h-20 bg-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-xl animate-bounce">
                            <span className="text-4xl text-white">ğŸ›¡ï¸</span>
                        </div>
                        <h1 className="text-3xl font-black text-slate-800 mb-6">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ØµÙ‚Ø± Ø§Ù„Ø£Ù…Ù†ÙŠØ©</h1>
                        <div className="space-y-4">
                            <input type="text" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ" className="w-full" onChange={e=>setLoginForm({...loginForm, id: e.target.value})} />
                            <input type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" className="w-full" onChange={e=>setLoginForm({...loginForm, password: e.target.value})} onKeyPress={e=>e.key==='Enter'&&handleLogin()} />
                            <button onClick={handleLogin} className="w-full action-btn py-4 text-lg">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="flex h-screen relative z-10">
                    {/* Sidebar */}
                    <aside className="glass-ui sidebar-container flex flex-col overflow-hidden">
                        <div className="p-8 text-center border-b border-white/20">
                            <div className="text-2xl font-black text-indigo-700">ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©</div>
                            <div className="text-[10px] text-slate-500 font-bold uppercase mt-1">Republic of Interior</div>
                        </div>
                        
                        <nav className="flex-grow pt-6 overflow-y-auto">
                            <button onClick={()=>setCurrentPage('dashboard')} className={`flex items-center w-[240px] p-4 nav-btn ${currentPage==='dashboard'?'nav-active':''}`}>
                                <span className="ml-3">ğŸ›ï¸</span> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                            </button>
                            <button onClick={()=>setCurrentPage('schedule')} className={`flex items-center w-[240px] p-4 nav-btn ${currentPage==='schedule'?'nav-active':''}`}>
                                <span className="ml-3">ğŸ“‹</span> Ø³Ø¬Ù„ Ø§Ù„Ø£ÙØ±Ø§Ø¯
                            </button>
                            <button onClick={()=>setCurrentPage('criminals')} className={`flex items-center w-[240px] p-4 nav-btn ${currentPage==='criminals'?'nav-active':''}`}>
                                <span className="ml-3">âš–ï¸</span> Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ÙŠÙ†
                            </button>
                            {isCommand(currentUser) && (
                                <button onClick={()=>setCurrentPage('users')} className={`flex items-center w-[240px] p-4 nav-btn ${currentPage==='users'?'nav-active text-amber-600':''}`}>
                                    <span className="ml-3">âš™ï¸</span> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
                                </button>
                            )}
                        </nav>

                        <div className="p-6 bg-white/20">
                            <div className="flex items-center gap-3 mb-4">
                                <div className="w-12 h-12 rounded-xl bg-indigo-600 text-white flex items-center justify-center font-bold">
                                    {currentUser.id === '1001' ? 'ğŸ‘‘' : currentUser.name[0]}
                                </div>
                                <div className="text-right">
                                    <p className="text-xs font-black text-slate-800">{currentUser.name}</p>
                                    <p className="text-[10px] text-indigo-600 font-bold uppercase">{currentUser.rank}</p>
                                </div>
                            </div>
                            <button onClick={()=>setIsLoggedIn(false)} className="w-full p-2 text-red-500 hover:bg-red-50 rounded-xl text-xs font-bold transition-all">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                        </div>
                    </aside>

                    {/* Main Content */}
                    <main className="glass-ui flex-grow main-container p-10">
                        <div className="flex justify-between items-start mb-10">
                            <div>
                                <h2 className="text-4xl font-black text-slate-800">
                                    {currentPage === 'dashboard' && 'Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©'}
                                    {currentPage === 'schedule' && 'Ø³Ø¬Ù„ Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ø¨Ø´Ø±ÙŠØ©'}
                                    {currentPage === 'criminals' && 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ¹Ù…ÙŠÙ…Ø§Øª'}
                                    {currentPage === 'users' && 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©'}
                                </h2>
                                <p className="text-indigo-600 font-bold text-sm mt-2 flex items-center">
                                    <span className="w-2 h-2 bg-green-500 rounded-full ml-2 animate-ping"></span>
                                    Ø¨Ø« Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
                                </p>
                            </div>
                            <div className="text-slate-400 font-mono text-sm bg-white/50 px-4 py-2 rounded-full border border-white">
                                {new Date().toLocaleDateString('ar-SA')}
                            </div>
                        </div>

                        {currentPage === 'dashboard' && (
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                                {[
                                    { t: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙˆØ©', v: users.length, i: 'ğŸ‘®', c: 'text-indigo-600' },
                                    { t: 'ØªØ¹Ù…ÙŠÙ…Ø§Øª Ù†Ø´Ø·Ø©', v: criminals.length, i: 'ğŸš¨', c: 'text-red-500' },
                                    { t: 'Ø§Ù„Ù…Ù‡Ù…Ø§Øª', v: '12', i: 'ğŸ¯', c: 'text-amber-500' },
                                    { t: 'Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…', v: '99%', i: 'ğŸ›¡ï¸', c: 'text-green-600' }
                                ].map((s, idx) => (
                                    <div key={idx} className="glass-ui p-8 card-stat cursor-default shadow-sm bg-white/30">
                                        <div className="text-3xl mb-4">{s.i}</div>
                                        <div className="text-xs font-black text-slate-400 uppercase mb-1">{s.t}</div>
                                        <div className={`text-4xl font-black ${s.c}`}>{s.v}</div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {currentPage === 'schedule' && (
                            <div className="glass-ui overflow-hidden bg-white/20">
                                <table className="w-full text-right">
                                    <thead>
                                        <tr className="bg-indigo-600/5 text-slate-500 text-xs font-black uppercase border-b border-white/30">
                                            <th className="p-6">Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø£Ù…Ù†Ù€ÙŠ</th>
                                            <th className="p-6">Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ©</th>
                                            <th className="p-6">Ø§Ù„Ù‚Ø·Ø§Ø¹</th>
                                            <th className="p-6">Ø§Ù„Ø±Ù‚Ù…</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-white/20">
                                        {users.map(u => (
                                            <tr key={u.id} className="hover:bg-white/40 transition-colors">
                                                <td className="p-6 flex items-center gap-3">
                                                    <div className="w-10 h-10 rounded-lg bg-indigo-100 flex items-center justify-center text-indigo-600 font-bold">ğŸ‘®</div>
                                                    <span className="font-bold text-slate-800">{u.name}</span>
                                                </td>
                                                <td className="p-6 text-sm font-bold text-indigo-700">{u.rank}</td>
                                                <td className="p-6 text-slate-500 text-sm">{u.department}</td>
                                                <td className="p-6 font-mono text-slate-400 text-xs">{u.id}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}

                        {currentPage === 'users' && isCommand(currentUser) && (
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                <div className="lg:col-span-1">
                                    <div className="glass-ui p-8 shadow-xl bg-white/40 border-t-4 border-t-indigo-600">
                                        <h3 className="text-xl font-black mb-6">ØªØ¹Ø¯ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                                        <div className="space-y-4">
                                            <input type="text" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ" disabled={isEditing} value={newUser.id} className="w-full" onChange={e=>setNewUser({...newUser, id: e.target.value})} />
                                            <input type="text" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" value={newUser.name} className="w-full" onChange={e=>setNewUser({...newUser, name: e.target.value})} />
                                            <input type="text" placeholder="Ø§Ù„Ù‚Ø³Ù…" value={newUser.department} className="w-full" onChange={e=>setNewUser({...newUser, department: e.target.value})} />
                                            <input type="text" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" value={newUser.password} className="w-full" onChange={e=>setNewUser({...newUser, password: e.target.value})} />
                                            <select className="w-full" value={newUser.rank} onChange={e=>setNewUser({...newUser, rank: e.target.value})}>
                                                {RANK_HIERARCHY.map(r => <option key={r.id} value={r.id}>{r.id}</option>)}
                                            </select>
                                            <button onClick={async() => {
                                                await window.fb.setDoc(window.fb.doc(window.fb.db, "users", newUser.id), newUser);
                                                setIsEditing(false); alert('ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­');
                                            }} className="w-full action-btn py-4">ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                                        </div>
                                    </div>
                                </div>
                                <div className="lg:col-span-2 space-y-4 overflow-y-auto max-h-[600px] pr-2">
                                    {users.map(u => (
                                        <div key={u.id} className="glass-ui p-6 flex justify-between items-center bg-white/20 hover:bg-white/50 transition-all group">
                                            <div className="flex items-center gap-4">
                                                <div className="w-14 h-14 rounded-2xl bg-indigo-600/10 text-indigo-600 flex items-center justify-center font-black text-xl">
                                                    {u.id.slice(-2)}
                                                </div>
                                                <div>
                                                    <p className="font-black text-slate-800">{u.name}</p>
                                                    <p className="text-[10px] text-indigo-500 font-bold uppercase">{u.rank} â€¢ {u.role}</p>
                                                </div>
                                            </div>
                                            <div className="flex gap-2">
                                                <button onClick={()=>{setNewUser(u); setIsEditing(true);}} className="p-3 hover:bg-white rounded-xl transition-all">ğŸ“</button>
                                                {u.id !== '1001' && <button onClick={async()=>confirm('Ø­Ø°ÙØŸ')&&await window.fb.deleteDoc(window.fb.doc(window.fb.db, "users", u.id))} className="p-3 text-red-500 hover:bg-red-50 rounded-xl">ğŸ—‘ï¸</button>}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {currentPage === 'criminals' && (
                            <div className="max-w-4xl mx-auto space-y-8">
                                {isOfficer(currentUser) && (
                                    <div className="glass-ui p-8 border-r-8 border-r-red-500 bg-red-50/10">
                                        <h3 className="text-xl font-black text-slate-800 mb-6 uppercase">Ø¥ØµØ¯Ø§Ø± ØªØ¹Ù…ÙŠÙ… Ø¹Ø§Ø¬Ù„</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‡Ø¯Ù" className="p-4" value={newCriminal.name} onChange={e=>setNewCriminal({...newCriminal, name: e.target.value})} />
                                            <input type="text" placeholder="Ù†ÙˆØ¹ Ø§Ù„Ø¬Ø±Ù…" className="p-4" value={newCriminal.crime} onChange={e=>setNewCriminal({...newCriminal, crime: e.target.value})} />
                                            <button onClick={async()=>{
                                                if(!newCriminal.name) return;
                                                await window.fb.addDoc(window.fb.collection(window.fb.db, "criminals"), {...newCriminal});
                                                setNewCriminal({name:'', crime:'', danger:'Ù…ØªÙˆØ³Ø·'});
                                            }} className="bg-red-600 text-white p-4 rounded-xl font-bold shadow-lg hover:bg-red-700">ØªØ¹Ù…ÙŠÙ… Ø§Ù„Ø¢Ù†</button>
                                        </div>
                                    </div>
                                )}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {criminals.map(c => (
                                        <div key={c.fbId} className="glass-ui p-8 flex justify-between items-center border border-red-200 bg-white/40 group">
                                            <div>
                                                <div className="bg-red-100 text-red-600 text-[10px] px-2 py-1 rounded inline-block font-black mb-2">TARGET</div>
                                                <h4 className="text-2xl font-black text-slate-800">{c.name}</h4>
                                                <p className="text-sm font-bold text-red-500/70 mt-1">{c.crime}</p>
                                            </div>
                                            {isOfficer(currentUser) && (
                                                <button onClick={async()=>await window.fb.deleteDoc(window.fb.doc(window.fb.db, "criminals", c.fbId))} className="w-12 h-12 flex items-center justify-center bg-red-50 text-red-600 rounded-full opacity-0 group-hover:opacity-100 transition-all">âœ–</button>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
