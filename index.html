<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIL-OS | COMMANDER ABDULLAH</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700;900&family=Noto+Kufi+Arabic:wght@400;700;900&display=swap');
        
        body { 
            font-family: 'Noto Kufi Arabic', sans-serif; 
            background: #0a0a0a; 
            height: 100vh; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            overflow: hidden;
            background-image: url('https://w0.peakpx.com/wallpaper/596/966/HD-wallpaper-army-camouflage-pattern-military.jpg');
            background-size: cover;
            background-position: center;
        }

        /* Phone Frame */
        .phone-container {
            width: 380px;
            height: 780px;
            background: rgba(10, 10, 10, 0.85);
            border: 12px solid #1a1a1a;
            border-radius: 50px;
            position: relative;
            box-shadow: 0 0 100px rgba(0,0,0,0.8), inset 0 0 20px rgba(0,0,0,1);
            overflow: hidden;
            backdrop-filter: blur(15px);
        }

        .phone-screen {
            height: 100%;
            display: flex;
            flex-grow: 1;
            flex-direction: column;
            padding: 20px;
            padding-top: 40px;
            position: relative;
        }

        /* Status Bar */
        .status-bar {
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            padding: 0 30px;
            display: flex;
            justify-content: space-between;
            font-family: 'Exo 2';
            font-size: 12px;
            color: white;
            z-index: 100;
        }

        /* App Icon Style */
        .app-icon {
            width: 70px;
            height: 70px;
            border-radius: 18px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            cursor: pointer;
            transition: 0.3s;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .app-icon:active { transform: scale(0.9); }
        .app-label { font-size: 11px; margin-top: 8px; font-weight: 900; color: white; text-align: center; }

        /* Window Overlay */
        .app-window {
            position: absolute;
            inset: 0;
            background: #0f172a;
            z-index: 200;
            padding: 20px;
            padding-top: 50px;
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .tactical-input {
            background: rgba(255,255,255,0.05) !important;
            border: 1px solid rgba(255,255,255,0.1) !important;
            color: white;
            border-radius: 15px;
            padding: 12px;
            outline: none;
            width: 100%;
        }

        .nav-bar {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 5px;
            background: white;
            border-radius: 10px;
            opacity: 0.5;
            cursor: pointer;
        }

        ::-webkit-scrollbar { width: 0px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, setDoc, doc, deleteDoc, query, orderBy, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyCYgffN2dA7IILMbI2i_1YfERkKWIrpHyA",
            authDomain: "ek-police.firebaseapp.com",
            projectId: "ek-police",
            storageBucket: "ek-police.firebasestorage.app",
            messagingSenderId: "300605258409",
            appId: "1:300605258409:web:f265025ffa5592f651c7b8"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.fb = { db, collection, onSnapshot, setDoc, doc, deleteDoc, query, orderBy, addDoc, serverTimestamp };
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const [isLocked, setIsLocked] = useState(true);
            const [user, setUser] = useState(null);
            const [openApp, setOpenApp] = useState(null);
            const [data, setData] = useState({ users: [], reports: [], uniforms: [] });
            const [forms, setForms] = useState({ login: {}, newUser: {rank:'Cadet'} });

            useEffect(() => {
                if (!window.fb) return;
                window.fb.onSnapshot(window.fb.collection(window.fb.db, "users"), s => setData(p => ({...p, users: s.docs.map(d=>d.data())})));
                window.fb.onSnapshot(window.fb.collection(window.fb.db, "uniforms"), s => setData(p => ({...p, uniforms: s.docs.map(d=>({...d.data(), fid: d.id}))})));
                const q = window.fb.query(window.fb.collection(window.fb.db, "field_reports"), window.fb.orderBy("createdAt", "desc"));
                window.fb.onSnapshot(q, s => setData(p => ({...p, reports: s.docs.map(d=>({...d.data(), fid: d.id}))})));
            }, []);

            const handleLogin = () => {
                const searchID = forms.login.id?.toUpperCase() === 'A-1' ? '1001' : forms.login.id;
                const found = data.users.find(u => u.id === searchID && u.password === forms.login.pass);
                if (found) { setUser(found); setIsLocked(false); } else alert("Access Denied");
            };

            const isCmd = (u) => u?.id === '1001';

            // -- Lock Screen --
            if (isLocked) return (
                <div className="phone-container">
                    <div className="status-bar"><span>03:27 AM</span><span>üì∂üîã 100%</span></div>
                    <div className="phone-screen flex flex-col items-center justify-center">
                        <div className="mb-10 text-center animate__animated animate__pulse animate__infinite">
                            <h1 className="text-5xl">üõ°Ô∏è</h1>
                            <p className="mt-4 font-black text-blue-500 tracking-widest">A-1 SECURE SYSTEM</p>
                        </div>
                        <div className="w-full space-y-3 px-4">
                            <input className="tactical-input text-center" placeholder="A-1" onChange={e=>setForms({...forms, login:{...forms.login, id:e.target.value}})} />
                            <input type="password" className="tactical-input text-center" placeholder="PIN" onChange={e=>setForms({...forms, login:{...forms.login, pass:e.target.value}})} />
                            <button onClick={handleLogin} className="w-full bg-blue-600 py-4 rounded-2xl font-black">UNLOCK</button>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="phone-container">
                    <div className="status-bar"><span>{new Date().getHours()}:{new Date().getMinutes()}</span><span>üì∂üîã 100%</span></div>
                    
                    {/* Home Screen */}
                    <div className="phone-screen">
                        <div className="grid grid-cols-3 gap-6 mt-10">
                            <div className="flex flex-col items-center" onClick={()=>setOpenApp('reports')}>
                                <div className="app-icon bg-gradient-to-br from-blue-500 to-indigo-700">üìù</div>
                                <span className="app-label">ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±</span>
                            </div>
                            <div className="flex flex-col items-center" onClick={()=>setOpenApp('force')}>
                                <div className="app-icon bg-gradient-to-br from-slate-600 to-slate-900">üë•</div>
                                <span className="app-label">ÿßŸÑŸÇŸàÿ©</span>
                            </div>
                            <div className="flex flex-col items-center" onClick={()=>setOpenApp('uniforms')}>
                                <div className="app-icon bg-gradient-to-br from-amber-500 to-orange-700">üëï</div>
                                <span className="app-label">ÿßŸÑŸÖÿ≥ÿ™ŸàÿØÿπ</span>
                            </div>
                            {isCmd(user) && (
                                <div className="flex flex-col items-center" onClick={()=>setOpenApp('admin')}>
                                    <div className="app-icon bg-gradient-to-br from-red-600 to-red-950 border-red-500/50">‚öôÔ∏è</div>
                                    <span className="app-label">ÿßŸÑÿ•ÿØÿßÿ±ÿ©</span>
                                </div>
                            )}
                        </div>
                        
                        <div className="mt-auto text-center mb-10 opacity-40">
                            <p className="text-[10px] font-black uppercase">Commander: {user.name}</p>
                        </div>
                    </div>

                    {/* App Windows */}
                    {openApp && (
                        <div className="app-window">
                            <div className="flex justify-between items-center mb-6">
                                <button onClick={()=>setOpenApp(null)} className="text-blue-500 font-black">‚úï ÿ•ÿ∫ŸÑÿßŸÇ</button>
                                <h3 className="text-sm font-black uppercase">{openApp}</h3>
                            </div>
                            
                            <div className="overflow-y-auto h-full pb-20">
                                {/* Admin App */}
                                {openApp === 'admin' && (
                                    <div className="space-y-6">
                                        <div className="bg-white/5 p-4 rounded-2xl">
                                            <h4 className="text-xs font-black text-blue-400 mb-4 uppercase">ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ÿÆÿØŸÖ</h4>
                                            <input className="tactical-input mb-2 text-xs" placeholder="ÿßŸÑÿ±ŸÇŸÖ ÿßŸÑÿπÿ≥ŸÉÿ±Ÿä" onChange={e=>setForms({...forms, newUser:{...forms.newUser, id:e.target.value}})} />
                                            <input className="tactical-input mb-2 text-xs" placeholder="ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ" onChange={e=>setForms({...forms, newUser:{...forms.newUser, name:e.target.value}})} />
                                            <input className="tactical-input mb-2 text-xs" placeholder="ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±" onChange={e=>setForms({...forms, newUser:{...forms.newUser, pass:e.target.value}})} />
                                            <button onClick={async()=>await window.fb.setDoc(window.fb.doc(window.fb.db, "users", forms.newUser.id), forms.newUser)} className="w-full bg-blue-600 py-3 rounded-xl font-black text-xs">ÿ≠ŸÅÿ∏</button>
                                        </div>
                                        <div className="space-y-2">
                                            {data.users.map(u => (
                                                <div key={u.id} className="flex justify-between items-center bg-white/5 p-3 rounded-xl">
                                                    <span className="text-xs font-bold">{u.name}</span>
                                                    {u.id !== '1001' && <button onClick={async()=>await window.fb.deleteDoc(window.fb.doc(window.fb.db, "users", u.id))} className="text-red-500 text-[10px]">ÿ≠ÿ∞ŸÅ</button>}
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* Reports App */}
                                {openApp === 'reports' && (
                                    <div className="space-y-4">
                                        <textarea className="tactical-input h-24 text-xs" placeholder="ÿßŸÉÿ™ÿ® ÿ®ŸÑÿßÿ∫ŸÉ ŸáŸÜÿß..." onChange={e=>setForms({...forms, report:e.target.value})}></textarea>
                                        <button onClick={async()=>await window.fb.addDoc(window.fb.collection(window.fb.db, "field_reports"), {
                                            content: forms.report, authorName: user.name, authorId: user.id, createdAt: window.fb.serverTimestamp()
                                        })} className="w-full bg-blue-600 py-3 rounded-xl font-black text-xs">ÿ£ÿ±ÿ¥ŸÅÿ©</button>
                                        <div className="space-y-3 mt-6">
                                            {data.reports.map(r => (
                                                <div key={r.fid} className="bg-white/5 p-4 rounded-2xl border-l-2 border-blue-500">
                                                    <div className="flex justify-between text-[10px] mb-2 opacity-50">
                                                        <span>{r.authorName}</span>
                                                        {(isCmd(user) || r.authorId === user.id) && <button onClick={async()=>await window.fb.deleteDoc(window.fb.doc(window.fb.db, "field_reports", r.fid))} className="text-red-500">ÿ≠ÿ∞ŸÅ</button>}
                                                    </div>
                                                    <p className="text-xs leading-relaxed">{r.content}</p>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {/* Force App */}
                                {openApp === 'force' && (
                                    <div className="grid grid-cols-1 gap-3">
                                        {data.users.map(u => (
                                            <div key={u.id} className="bg-white/5 p-4 rounded-2xl flex items-center gap-4">
                                                <div className="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center font-black text-xs">{u.id === '1001' ? 'A-1' : u.id}</div>
                                                <div>
                                                    <h4 className="text-xs font-black">{u.name}</h4>
                                                    <p className="text-[10px] opacity-50 uppercase">{u.rank}</p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    <div className="nav-bar" onClick={()=>setOpenApp(null)}></div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
